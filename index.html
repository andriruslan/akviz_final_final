<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
  <title>–ê–∫–í—ñ–∑_–ö–ê–ì–ê–†–õ–ò–ö</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', 'Roboto', sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      overflow-x: hidden;
      touch-action: manipulation;
    }

    body {
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 500px;
      padding: 16px;
      box-sizing: border-box;
    }

    h2 {
      text-align: center;
      font-weight: bold;
      font-size: 1.4rem;
      color: #fff;
      margin-bottom: 1rem;
    }

    .group {
      margin-bottom: 1.4rem;
    }

    label {
      font-weight: bold;
      font-size: 1.05rem;
      display: block;
      margin-bottom: 0.3rem;
    }

    hr {
      border: none;
      border-bottom: 1px solid #444;
      margin: 4px 0 10px 0;
    }

    input[type="text"],
    input[type="number"],
    input[type="time"],
    textarea {
      width: 100%;
      padding: 8px;
      font-size: 1rem;
      background-color: #1e1e1e;
      border: 1px solid #333;
      border-radius: 5px;
      color: #fff;
      box-sizing: border-box;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: #4caf50;
    }

    button {
      font-size: 1rem;
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    .plus-button {
      background-color: #2e7d32;
      color: white;
      width: 100%;
      border-radius: 10px;
    }

    .minus-button {
      background-color: #b71c1c;
      color: white;
      width: 100%;
      border-radius: 10px;
    }

    .inline-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .inline-buttons button {
      flex: 1 1 48%;
    }

    .three-cols {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .three-cols label {
      flex: 1 1 calc(33.3% - 8px);
    }

    .two-cols {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .two-cols label {
      flex: 1 1 calc(50% - 8px);
    }

    .two-rows-buttons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-top: 8px;
    }

    .three-cols-buttons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-top: 8px;
    }

    #preview {
      background: #1a1a1a;
      border: 1px solid #444;
      padding: 8px;
      white-space: pre-wrap;
      font-family: monospace;
      min-height: 100px;
      color: #fff;
    }

    .full-width-button {
      width: 100%;
    }

    .half-button {
      flex: 1 1 48%;
    }

    .ammo-flex {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .ammo-item {
      flex: 1 1 calc(50% - 1rem);
    }
.flex.flex-wrap.justify-between label {
  flex: 1 1 30%;
}
    *******
    .radio-inline-group.side-3col {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.5rem;
}
*****
.field-with-lock {
  display: flex;
  gap: 0.3rem;
  align-items: center;
}

.field-with-lock input {
  flex: 1;
  font-size: 1rem;
  padding: 0.4rem;
}

.lock-btn {
  padding: 0.4rem 0.7rem;
  font-size: 1rem;
  background: #ddd;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
.field-row {
  display: flex;
  align-items: center;
  gap: 0.4rem;
}

.field-row input {
  flex: 1;
  padding: 0.5rem;
  font-size: 1rem;
}

.lock-btn {
  padding: 0.4rem 0.6rem;
  font-size: 1.2rem;
  background-color: #eee;
  border: 1px solid #ccc;
  border-radius: 5px;
  cursor: pointer;
}
.side-3col {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.3rem;
}

.side-3col label {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  font-size: 0.95rem;
}
  </style>
</head>
<body>
  <div class="container">
    <h2>–ê–∫–í—ñ–∑_–ö–ê–ì–ê–†–õ–ò–ö</h2>
  <div class="group">
  <label for="sector">–ü—ñ–¥–ø–æ—Ä—è–¥–∫—É–≤–∞–Ω–Ω—è</label>
  <div class="field-row">
    <input type="text" id="sector" readonly />
    <button type="button" class="lock-btn" onclick="toggleLock('sector')">üîì</button>
  </div>
</div>

  <div class="group">
  <label for="position">–ü–æ–∑–∏—Ü—ñ—è</label>
  <div class="field-row">
    <input type="text" id="position" readonly />
    <button type="button" class="lock-btn" onclick="toggleLock('position')">üîì</button>
  </div>
</div>

  <div class="group">
  <label for="location">–ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç</label>
  <div class="field-row">
    <input type="text" id="location" readonly />
    <button type="button" class="lock-btn" onclick="toggleLock('location')">üîì</button>
  </div>
</div>

   <div class="group">
  <label>–¢–∏–ø —Ü—ñ–ª—ñ</label>
  <hr>
  <div class="radio-group">
    <label><input type="radio" name="target" value="–ë–ü–õ–ê –ª—ñ—Ç–∞–∫–æ–≤–æ–≥–æ —Ç–∏–ø—É"> –ë–ü–õ–ê –ª—ñ—Ç–∞–∫–æ–≤–æ–≥–æ —Ç–∏–ø—É</label>
    <label><input type="radio" name="target" value="–ü–æ—Å—Ç—Ä—ñ–ª–∏ (–ó–£,–∫—É–ª–µ–º–µ—Ç)"> –ü–æ—Å—Ç—Ä—ñ–ª–∏ (–ó–£,–∫—É–ª–µ–º–µ—Ç)</label>
    <label><input type="radio" name="target" value="–í–∏—Ö–æ–¥–∏ (–ü–ó–†–ö,–ó–†–ö)"> –í–∏—Ö–æ–¥–∏ (–ü–ó–†–ö,–ó–†–ö)</label>
    <label><input type="radio" name="target" value="–ö–† (–∫—Ä–∏–ª–∞—Ç–∞ —Ä–∞–∫–µ—Ç–∞)"> –ö–† (–∫—Ä–∏–ª–∞—Ç–∞ —Ä–∞–∫–µ—Ç–∞)</label>
    <label><input type="radio" name="target" value="–í–∏–±—É—Ö"> –í–∏–±—É—Ö</label>
    <label><input type="radio" name="target" value="–õ–ú (–õ—ñ—Ç–∞–∫ –º–∞–ª–∏–π)"> –õ–ú (–õ—ñ—Ç–∞–∫ –º–∞–ª–∏–π)</label>
    <label><input type="radio" name="target" value="–õ–í (–õ—ñ—Ç–∞–∫ –≤–µ–ª–∏–∫–∏–π)"> –õ–í (–õ—ñ—Ç–∞–∫ –≤–µ–ª–∏–∫–∏–π)</label>
    <label><input type="radio" name="target" value="–ì (–ì–µ–ª—ñ–∫–æ–ø—Ç–µ—Ä)"> –ì (–ì–µ–ª—ñ–∫–æ–ø—Ç–µ—Ä)</label>
    <label><input type="radio" name="target" value="–ö (–∫–≤–∞–¥—Ä–æ–∫–æ–ø—Ç–µ—Ä)"> –ö (–∫–≤–∞–¥—Ä–æ–∫–æ–ø—Ç–µ—Ä)</label>
    <label><input type="radio" name="target" value="–ó (–ó–æ–Ω–¥)"> –ó (–ó–æ–Ω–¥)</label>
    <label><input type="radio" name="target" value="–Ü–Ω—à–µ (–¥–µ—Ç–∞–ª—ñ –≤ –æ–ø–∏—Å—ñ)"> –Ü–Ω—à–µ (–¥–µ—Ç–∞–ª—ñ –≤ –æ–ø–∏—Å—ñ)</label>
  </div>
</div>

<div class="group">
  <label>–°—Ç–æ—Ä–æ–Ω–∞</label>
  <hr>
  <div class="side-3col">
    <label><input type="radio" name="side" value="–í–æ—Ä–æ–∂–∏–π"> –í–æ—Ä–æ–∂–∏–π</label>
    <label><input type="radio" name="side" value="–°–≤—ñ–π"> –°–≤—ñ–π</label>
    <label><input type="radio" name="side" value="–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∏–π"> –ù–µ–π—Ç—Ä–∞–ª—å–Ω–∏–π</label>
  </div>
</div>


    <div class="group">
      <label>–ù–æ–º–µ—Ä —Ü—ñ–ª—ñ</label>
      <hr>
      <label><input type="checkbox" id="noNumber" checked onchange="toggleNumberField()"> –ë–µ–∑ –≤–∏–¥–∞—á—ñ</label>
      <input type="number" id="targetNumber" inputmode="numeric" pattern="[0-9]*" placeholder="–Ω–æ–º–µ—Ä —Ü—ñ–ª—ñ" readonly />
    </div>
    <div class="group">
      <label>–ù–∞–∑–≤–∞</label>
      <hr>
      <input type="text" id="targetName" placeholder="–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Shahed-136" />
      <div class="inline-buttons">
        <button class="minus-button" onclick="setTargetNameAndUpdate('Shahed-136')">Shahed-136</button>
        <button class="minus-button" onclick="setTargetNameAndUpdate('–ì–µ—Ä–±–µ—Ä–∞')">–ì–µ—Ä–±–µ—Ä–∞</button>
      </div>
    </div>

    <div class="group">
      <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å, –æ–¥</label>
      <hr>
      <input type="number" id="targetCount" value="1" readonly inputmode="numeric" />
      <div class="inline-buttons">
        <button class="plus-button" onclick="changeCount(1)">+1 –æ–¥.</button>
        <button class="minus-button" id="minusBtn" onclick="changeCount(-1)" disabled>-1 –æ–¥.</button>
      </div>
    </div>

  <div class="group">
  <label>–ê–∑–∏–º—É—Ç, ¬∞</label>
  <div class="field-row">
    <input type="number" id="azimuth" placeholder="–í–≤–µ–¥—ñ—Ç—å –∞–±–æ –≤–∏–∑–Ω–∞—á—Ç–µ" inputmode="numeric" />
    <button id="azimuthBtn" onclick="toggleSensor('azimuth')">–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∞–∑–∏–º—É—Ç</button>
  </div>
</div>

<div class="group">
  <label>–ö—É—Ä—Å, ¬∞</label>
  <div class="field-row">
    <input type="number" id="course" placeholder="–í–≤–µ–¥—ñ—Ç—å –∞–±–æ –≤–∏–∑–Ω–∞—á—Ç–µ" inputmode="numeric" />
    <button id="courseBtn" onclick="toggleSensor('course')">–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∫—É—Ä—Å</button>
  </div>
</div>

<!-- –û–ø—Ü—ñ–π–Ω–æ: –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ -->


    <div class="group">
      <label>–í—ñ–¥—Å—Ç–∞–Ω—å+, –º</label>
      <hr>
      <input type="number" id="distance" inputmode="numeric" placeholder="–≤–∏—Å–æ—Ç–∞ –ø—Ä–æ–ª—å–æ—Ç—É —Ü—ñ–ª—ñ" />
      <div class="two-rows-buttons">
        <button class="plus-button" onclick="adjustValue('distance', 100)">+100 –º</button>
        <button class="plus-button" onclick="adjustValue('distance', 1000)">+1000 –º</button>
        <button class="plus-button" onclick="adjustValue('distance', 5000)">+5000 –º</button>
        <button class="minus-button" onclick="adjustValue('distance', -100)">-100 –º</button>
        <button class="minus-button" onclick="adjustValue('distance', -1000)">-1000 –º</button>
        <button class="minus-button" onclick="adjustValue('distance', -5000)">-5000 –º</button>
      </div>
    </div>

    <div class="group">
      <label>–í–∏—Å–æ—Ç–∞, –º</label>
      <hr>
      <input type="number" id="height" inputmode="numeric" placeholder="–≤–∏—Å–æ—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö" />
     <div class="inline-buttons" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
  <button class="plus-button" onclick="adjustValue('height', 100)">+100 –º</button>
  <button class="plus-button" onclick="adjustValue('height', 500)">+500 –º</button>
  <button class="minus-button" onclick="adjustValue('height', -100)">-100 –º</button>
  <button class="minus-button" onclick="adjustValue('height', -500)">-500 –º</button>
</div>

    </div>
    <div class="group">
      <label>–ß–∞—Å</label>
      <hr>
      <input type="time" id="time" required />
      <div class="three-cols-buttons">
        <button class="plus-button" onclick="setNowTime()">–©–æ–π–Ω–æ</button>
        <button class="plus-button" onclick="changeTime(1)">+1 —Ö–≤.</button>
        <button class="minus-button" onclick="changeTime(-1)">-1 —Ö–≤.</button>
      </div>
    </div>

    <div class="group">
      <label>–í–∏—è–≤–ª–µ–Ω–Ω—è</label>
      <hr>
      <div class="three-cols">
        <label><input type="checkbox" id="acoustic"> –ê–∫—É—Å—Ç–∏—á–Ω–æ</label>
        <label><input type="checkbox" id="radar"> –†–∞–¥—ñ–æ–ª–æ–∫–∞—Ü—ñ–π–Ω–æ</label>
        <label><input type="checkbox" id="visual" onchange="checkDetect()"> –í—ñ–∑—É–∞–ª—å–Ω–æ</label>
        <label><input type="checkbox" id="obs" disabled> –ü—Ä–∏–ª–∞–¥</label>
      </div>
    </div>

 <div class="group">
  <label>–†–µ–∑—É–ª—å—Ç–∞—Ç</label>
  <hr>
  <div class="three-cols">
    <label><input type="radio" name="result" value="–í–∏—è–≤–ª–µ–Ω–æ" onchange="updateAmmoVisibility()"> –í–∏—è–≤–ª–µ–Ω–æ</label>
    <label><input type="radio" name="result" value="–û–±—Å—Ç—Ä—ñ–ª—è–Ω–æ" onchange="updateAmmoVisibility()"> –û–±—Å—Ç—Ä—ñ–ª—è–Ω–æ</label>
    <label><input type="radio" name="result" value="–£—Ä–∞–∂–µ–Ω–æ" onchange="updateAmmoVisibility()"> –£—Ä–∞–∂–µ–Ω–æ</label>
  </div>
</div>

    <div class="group" id="ammoGroup" style="display: none;">
      <label>–†–æ–∑—Ö—ñ–¥ –ë–ö</label>
      <hr>
      <div class="ammo-flex">
        <div class="ammo-item">
          <label><input type="checkbox" id="ammo1" onchange="toggleAmmoCount('ammo1')"> –ê–ö-74 - 5.45</label>
          <input type="number" id="ammo1Count" disabled inputmode="numeric" placeholder="—à—Ç.">
        </div>
        <div class="ammo-item">
          <label><input type="checkbox" id="ammo2" onchange="toggleAmmoCount('ammo2')"> CANiK M2</label>
          <input type="number" id="ammo2Count" disabled inputmode="numeric" placeholder="—à—Ç.">
        </div>
        <div class="ammo-item">
          <label><input type="checkbox" id="ammo3" onchange="toggleAmmoCount('ammo3')"> –î–ü-27 7.62</label>
          <input type="number" id="ammo3Count" disabled inputmode="numeric" placeholder="—à—Ç.">
        </div>
        <!--
        <div class="ammo-item">
          <label><input type="checkbox" id="ammo4" onchange="toggleAmmoCount('ammo4')"> –Ü–Ω—à–µ</label>
          <input type="number" id="ammo4Count" disabled inputmode="numeric" placeholder="—à—Ç.">
        </div>
        -->
      </div>
    </div>
    <div class="group">
      <label>–û–ø–∏—Å</label>
      <hr>
      <div class="two-cols">
        <label><input type="checkbox" id="descSound"> –∑–º—ñ–Ω–∏–≤ –∑–≤—É–∫</label>
        <label><input type="checkbox" id="descCourse"> –∑–º—ñ–Ω–∏–≤ –∫—É—Ä—Å</label>
      </div>
      <textarea id="description" maxlength="360" placeholder="–î–æ–¥–∞—Ç–∫–æ–≤–∏–π –æ–ø–∏—Å (–¥–æ 360 —Å–∏–º–≤–æ–ª—ñ–≤)"></textarea>
    </div>

    <div class="group">
      <label>–ú—ñ–Ω—ñ-–∑–≤—ñ—Ç</label>
      <hr>
      <pre id="preview">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è...</pre>
    </div>

    <div class="group">
      <div class="inline-buttons">
        <button class="plus-button full-width-button" onclick="copyReport()">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –∑–≤—ñ—Ç</button>
        <button class="plus-button full-width-button" onclick="sendToSignal()">üì® –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≤ Signal</button>
      </div>
    </div>

    <div class="group">
      <label>üß≠ –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–æ–º–ø–∞—Å–∞</label>
      <hr>
      <div id="debug">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö...</div>
    </div>
  </div> 
  
<script>
let sensorActive = { azimuth: false, course: false };
let currentField = null;
let lastUpdate = 0;

function toggleLock(id) {
  const input = document.getElementById(id);
  input.readOnly = !input.readOnly;
  const btn = input.nextElementSibling;
  if (btn && btn.tagName === "BUTTON") {
    btn.textContent = input.readOnly ? "üîì" : "üîí";
  }
  if (!input.readOnly) input.focus();
  else localStorage.setItem(id, input.value);
}

function loadStoredFields() {
  ['sector', 'position', 'location'].forEach(id => {
    const val = localStorage.getItem(id);
    if (val) document.getElementById(id).value = val;
  });
}

function toggleNumberField() {
  const no = document.getElementById('noNumber');
  const num = document.getElementById('targetNumber');
  num.readOnly = no.checked;
  if (no.checked) num.value = '';
}

function changeCount(delta) {
  const input = document.getElementById("targetCount");
  let val = parseInt(input.value) || 1;
  val += delta;
  if (val < 1) val = 1;
  input.value = val;
  updatePreview();
}

function adjustValue(id, delta) {
  const input = document.getElementById(id);
  let val = parseInt(input.value) || 0;
  val += delta;
  if (val < 0) val = 0;
  input.value = val;
  updatePreview();
}

function checkDetect() {
  const vis = document.getElementById("visual");
  const obs = document.getElementById("obs");
  obs.disabled = !vis.checked;
  if (!vis.checked) obs.checked = false;
}

function setNowTime() {
  const now = new Date();
  const h = now.getHours().toString().padStart(2,'0');
  const m = now.getMinutes().toString().padStart(2,'0');
  document.getElementById("time").value = `${h}:${m}`;
}

function changeTime(delta) {
  const time = document.getElementById("time");
  if (!time.value) return setNowTime();
  let [h, m] = time.value.split(":").map(Number);
  const t = new Date();
  t.setHours(h, m + delta);
  time.value = `${t.getHours().toString().padStart(2,'0')}:${t.getMinutes().toString().padStart(2,'0')}`;
  updatePreview();
}

function updateAmmoVisibility() {
  const result = document.querySelector('input[name="result"]:checked')?.value;
  document.getElementById("ammoGroup").style.display =
    (result === "–û–±—Å—Ç—Ä—ñ–ª—è–Ω–æ" || result === "–£—Ä–∞–∂–µ–Ω–æ") ? "block" : "none";
}

function toggleAmmoCount(id) {
  const cb = document.getElementById(id);
  const count = document.getElementById(id + "Count");
  count.disabled = !cb.checked;
  if (!cb.checked) count.value = '';
}

function setTargetNameAndUpdate(name) {
  document.getElementById("targetName").value = name;
  updatePreview();
}

function generateReportText() {
  const get = id => document.getElementById(id)?.value || "-";
  const isChecked = id => document.getElementById(id)?.checked;
  const checkedVal = name => document.querySelector(`input[name="${name}"]:checked`)?.value || "-";
  const targetNumber = isChecked("noNumber") ? "–±–µ–∑ –≤–∏–¥–∞—á—ñ" : get("targetNumber");

  const detections = [];
  if (isChecked("acoustic")) detections.push("–ê–∫—É—Å—Ç–∏—á–Ω–æ");
  if (isChecked("radar")) detections.push("–†–∞–¥—ñ–æ–ª–æ–∫–∞—Ü—ñ–π–Ω–æ");
  if (isChecked("visual")) detections.push("–í—ñ–∑—É–∞–ª—å–Ω–æ");
  if (isChecked("obs")) detections.push("–ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∑–∞—Å–æ–±—ñ–≤");

  const result = checkedVal("result");

  // –†–æ–∑—Ö—ñ–¥ –ë–ö
  let ammoText = "";
  if (result === "–û–±—Å—Ç—Ä—ñ–ª—è–Ω–æ" || result === "–£—Ä–∞–∂–µ–Ω–æ") {
    [["ammo1", "–ê–ö-74 (5.45—Ö39–º–º)"], ["ammo2", "CANiK M2 (12.7—Ö99–º–º)"], ["ammo3", "–î–ü-27 (7.62x54–º–º)"]].forEach(([id, label]) => {
      if (isChecked(id)) {
        const qty = get(id + "Count");
        if (qty) ammoText += `${label} - ${qty} —à—Ç.\n`;
      }
    });
  }

  // –û–ø–∏—Å
  let desc = [];
  const custom = get("description");
  const sound = isChecked("descSound");
  const course = isChecked("descCourse");
  if (result === "–û–±—Å—Ç—Ä—ñ–ª—è–Ω–æ" || result === "–£—Ä–∞–∂–µ–Ω–æ") {
    if (sound && course) desc.push("–ü—ñ—Å–ª—è –æ–±—Å—Ç—Ä—ñ–ª—É —Ü—ñ–ª—å –∑–º—ñ–Ω–∏–ª–∞ –∑–≤—É–∫ —Ç–∞ –∫—É—Ä—Å.");
    else if (sound) desc.push("–ü—ñ—Å–ª—è –æ–±—Å—Ç—Ä—ñ–ª—É —Ü—ñ–ª—å –∑–º—ñ–Ω–∏–ª–∞ –∑–≤—É–∫.");
    else if (course) desc.push("–ü—ñ—Å–ª—è –æ–±—Å—Ç—Ä—ñ–ª—É —Ü—ñ–ª—å –∑–º—ñ–Ω–∏–ª–∞ –∫—É—Ä—Å.");
  }
  if (custom) desc.push(custom);

  return `–ü: ${get("sector")}, ${get("position")}
–¶—ñ–ª—å: ${checkedVal("target")}, ${checkedVal("side")}, ${targetNumber}
–ù–∞–∑–≤–∞: ${get("targetName")}
–ö—ñ–ª—å–∫—ñ—Å—Ç—å: ${get("targetCount")} –æ–¥
–ê: ${get("azimuth")}¬∞, –ö: ${get("course")}¬∞
–í–∏—Å–æ—Ç–∞: ${get("height")} –º, –í—ñ–¥—Å—Ç–∞–Ω—å: ${get("distance")} –º
–ù–ü: ${get("location")}
–ß–∞—Å: ${get("time")}
–í–∏—è–≤: ${detections.join(", ")}
–ü–ü: ${result}
${ammoText ? "–†–æ–∑—Ö—ñ–¥ –ë–ö:\n" + ammoText.trim() : ""}${desc.length ? "\n–û–ø–∏—Å: " + desc.join(" ") : ""}`.trim();
}

function updatePreview() {
  document.getElementById("preview").textContent = generateReportText();
}

function copyReport() {
  navigator.clipboard.writeText(generateReportText()).then(updatePreview);
}

function sendToSignal() {
  navigator.clipboard.writeText(generateReportText()).then(() => {
    updatePreview();
    window.location.href = "sgnl://";
  });
}

function attachReportUpdateListeners() {
  document.querySelectorAll("input, textarea").forEach(el => {
    el.addEventListener("input", updatePreview);
    el.addEventListener("change", () => {
      updateAmmoVisibility();
      updatePreview();
    });

    if (el.type === "checkbox" || el.type === "radio") {
      el.addEventListener("click", updatePreview);
    }

    if (el.id) {
      const label = document.querySelector(`label[for="${el.id}"]`);
      if (label) {
        label.style.cursor = "pointer";
        label.addEventListener("click", () => el.click());
      }
    }
  });
}

// --- –ö–æ–º–ø–∞—Å iOS + Android ---
function toggleSensor(field) {
  if (sensorActive[field]) {
    stopSensor(field);
  } else if (
    typeof DeviceOrientationEvent !== "undefined" &&
    typeof DeviceOrientationEvent.requestPermission === "function"
  ) {
    DeviceOrientationEvent.requestPermission()
      .then(resp => resp === "granted" ? startSensor(field) : alert("‚ùå –î–æ—Å—Ç—É–ø –¥–æ –∫–æ–º–ø–∞—Å–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ."))
      .catch(() => alert("‚ùå –ù–µ–º–æ–∂–ª–∏–≤–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø."));
  } else {
    startSensor(field);
  }
}

function startSensor(field) {
  sensorActive[field] = true;
  currentField = field;
  lastUpdate = 0;
  document.getElementById(field + "Btn").textContent = "–ó–±–µ—Ä–µ–≥—Ç–∏";
  window.addEventListener("deviceorientation", onDeviceOrientation);
  document.getElementById("debug").textContent = `‚è≥ –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è ${field}...`;
}

function stopSensor(field) {
  sensorActive[field] = false;
  currentField = null;
  document.getElementById(field + "Btn").textContent =
    field === "azimuth" ? "–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∞–∑–∏–º—É—Ç" : "–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∫—É—Ä—Å";
  window.removeEventListener("deviceorientation", onDeviceOrientation);
  document.getElementById("debug").textContent = `‚õî –ö–æ–º–ø–∞—Å –≤–∏–º–∫–Ω–µ–Ω–æ`;
}

function onDeviceOrientation(event) {
  if (!currentField) return;

  let heading = null;

  if (typeof event.webkitCompassHeading === "number") {
    heading = event.webkitCompassHeading;
  } else if (typeof event.alpha === "number") {
    heading = 360 - event.alpha + 90;
    if (heading >= 360) heading -= 360;
  }

  if (heading != null) {
    const now = Date.now();
    if (now - lastUpdate < 300) return;
    lastUpdate = now;

    heading = Math.round(heading % 360);
    document.getElementById(currentField).value = heading;
    document.getElementById("debug").textContent = `üìç ${currentField}: ${heading}¬∞`;
    updatePreview();
  }
}

window.onload = () => {
  loadStoredFields();
  toggleNumberField();
  setNowTime();
  checkDetect();
  updateAmmoVisibility();
  attachReportUpdateListeners();
  updatePreview();

  document.querySelectorAll("button").forEach(btn =>
    btn.addEventListener("dblclick", e => e.preventDefault())
  );
};
</script>
</body>
</html>
