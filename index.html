<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ê–∫–í—ñ–∑_–ö–ê–ì–ê–†–õ–ò–ö</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; background: #f2f2f2; }
    h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
    .version { font-size: 0.9rem; color: #555; margin-bottom: 1rem; }
    .group { margin-bottom: 1rem; }
    label { display: block; margin-bottom: 0.3rem; }
    input[type=text], input[type=number], input[type=time], textarea {
      width: 100%; padding: 0.5rem; font-size: 1rem;
    }
    input[readonly] { background-color: #eaeaea; }
    button {
      padding: 0.4rem 1rem;
      font-size: 1rem;
      margin-top: 0.5rem;
      margin-right: 0.5rem;
    }
    .lock-button {
      background: none; border: none; font-size: 1.3rem; cursor: pointer;
    }
    .inline-buttons { display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: center; }
    .radio-group { display: flex; flex-direction: column; gap: 0.3rem; }
    #debug { font-family: monospace; font-size: 0.9rem; color: #666; }
  </style>
</head>
<body>
  <h1>–ê–∫–í—ñ–∑_–ö–ê–ì–ê–†–õ–ò–ö</h1>
  <div class="version">–í–µ—Ä—Å—ñ—è 1.1.3</div>

  <div class="group">
    <label>–ü—ñ–¥–ø–æ—Ä—è–¥–∫—É–≤–∞–Ω–Ω—è (*)</label>
    <div class="inline-buttons">
      <input id="sector" type="text" readonly>
      <button class="lock-button" onclick="toggleLock('sector')">üîí</button>
    </div>
  </div>

  <div class="group">
    <label>–ü–æ–∑–∏—Ü—ñ—è (*)</label>
    <div class="inline-buttons">
      <input id="position" type="text" readonly>
      <button class="lock-button" onclick="toggleLock('position')">üîí</button>
    </div>
  </div>

  <div class="group">
    <label>–ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç (*)</label>
    <div class="inline-buttons">
      <input id="location" type="text" readonly>
      <button class="lock-button" onclick="toggleLock('location')">üîí</button>
    </div>
  </div>
  <div class="group">
    <label>–¢–∏–ø —Ü—ñ–ª—ñ</label>
    <div class="radio-group">
      <label><input type="radio" name="target" value="–ë–ü–õ–ê –ª—ñ—Ç–∞–∫–æ–≤–æ–≥–æ —Ç–∏–ø—É"> –ë–ü–õ–ê –ª—ñ—Ç–∞–∫–æ–≤–æ–≥–æ —Ç–∏–ø—É</label>
      <label><input type="radio" name="target" value="–ü–æ—Å—Ç—Ä—ñ–ª–∏ (–ó–£, –∫—É–ª–µ–º–µ—Ç)"> –ü–æ—Å—Ç—Ä—ñ–ª–∏ (–ó–£, –∫—É–ª–µ–º–µ—Ç)</label>
      <label><input type="radio" name="target" value="–í–∏—Ö–æ–¥–∏ (–ü–ó–†–ö, –ó–†–ö)"> –í–∏—Ö–æ–¥–∏ (–ü–ó–†–ö, –ó–†–ö)</label>
      <label><input type="radio" name="target" value="–í–∏–±—É—Ö –ö–†"> –í–∏–±—É—Ö –ö–†</label>
      <label><input type="radio" name="target" value="–ì–µ–ª—ñ–∫–æ–ø—Ç–µ—Ä"> –ì–µ–ª—ñ–∫–æ–ø—Ç–µ—Ä</label>
      <label><input type="radio" name="target" value="–õ—ñ—Ç–∞–∫ (–º–∞–ª–∏–π)"> –õ—ñ—Ç–∞–∫ (–º–∞–ª–∏–π)</label>
      <label><input type="radio" name="target" value="–õ—ñ—Ç–∞–∫ (–≤–µ–ª–∏–∫–∏–π)"> –õ—ñ—Ç–∞–∫ (–≤–µ–ª–∏–∫–∏–π)</label>
      <label><input type="radio" name="target" value="–ó–æ–Ω–¥"> –ó–æ–Ω–¥</label>
      <label><input type="radio" name="target" value="–ù–µ–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–µ"> –ù–µ–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–µ</label>
      <label><input type="radio" name="target" value="–Ü–Ω—à–µ"> –Ü–Ω—à–µ</label>
      <label><input type="radio" name="target" value="–ê–µ—Ä–æ—Å—Ç–∞—Ç"> –ê–µ—Ä–æ—Å—Ç–∞—Ç</label>
    </div>
  </div>

  <div class="group">
    <label>–°—Ç–æ—Ä–æ–Ω–∞</label>
    <div class="radio-group">
      <label><input type="radio" name="side" value="–í–æ—Ä–æ–∂–∏–π"> –í–æ—Ä–æ–∂–∏–π</label>
      <label><input type="radio" name="side" value="–°–≤—ñ–π"> –°–≤—ñ–π</label>
      <label><input type="radio" name="side" value="–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∏–π"> –ù–µ–π—Ç—Ä–∞–ª—å–Ω–∏–π</label>
    </div>
  </div>

  <div class="group">
    <label><input type="checkbox" id="noNumber" checked onchange="toggleNumberField()"> –ë–µ–∑ –≤–∏–¥–∞—á—ñ</label>
    <input type="number" id="targetNumber" placeholder="–Ω–æ–º–µ—Ä —Ü—ñ–ª—ñ" readonly>
  </div>

  <div class="group">
    <label>–ù–∞–∑–≤–∞</label>
    <input type="text" id="targetName" placeholder="–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Shahed-136">
    <div class="inline-buttons">
      <button onclick="document.getElementById('targetName').value='Shahed-136'">Shahed-136</button>
      <button onclick="document.getElementById('targetName').value='–ì–µ—Ä–±–µ—Ä–∞'">–ì–µ—Ä–±–µ—Ä–∞</button>
    </div>
  </div>

  <div class="group">
    <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å, –æ–¥</label>
    <div class="inline-buttons">
      <input type="number" id="targetCount" value="1" readonly>
      <button onclick="changeCount(1)">+1 –æ–¥.</button>
      <button id="minusBtn" onclick="changeCount(-1)" disabled>-1 –æ–¥.</button>
    </div>
  </div>
  <div class="group">
    <label>–ê–∑–∏–º—É—Ç, ¬∞ (*)</label>
    <input type="number" id="azimuth" placeholder="–í–≤–µ–¥—ñ—Ç—å –∞–±–æ –≤–∏–∑–Ω–∞—á—Ç–µ">
    <button id="azimuthBtn" onclick="toggleSensor('azimuth')">–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∞–∑–∏–º—É—Ç</button>
  </div>

  <div class="group">
    <label>–ö—É—Ä—Å, ¬∞ (*)</label>
    <input type="number" id="course" placeholder="–í–≤–µ–¥—ñ—Ç—å –∞–±–æ –≤–∏–∑–Ω–∞—á—Ç–µ">
    <button id="courseBtn" onclick="toggleSensor('course')">–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ö—É—Ä—Å</button>
  </div>

  <div class="group">
    <label>–í—ñ–¥—Å—Ç–∞–Ω—å+, –º (*)</label>
    <input type="number" id="distance" placeholder="–≤–∏—Å–æ—Ç–∞ –ø—Ä–æ–ª—å–æ—Ç—É —Ü—ñ–ª—ñ">
    <div class="inline-buttons">
      <button onclick="adjustValue('distance', 100)">+100 –º</button>
      <button onclick="adjustValue('distance', 1000)">+1000 –º</button>
      <button onclick="adjustValue('distance', 5000)">+5000 –º</button>
      <button onclick="adjustValue('distance', -100)">-100 –º</button>
      <button onclick="adjustValue('distance', -1000)">-1000 –º</button>
      <button onclick="adjustValue('distance', -5000)">-5000 –º</button>
    </div>
  </div>

  <div class="group">
    <label>–í–∏—Å–æ—Ç–∞, –º</label>
    <input type="number" id="height" placeholder="–≤–∏—Å–æ—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö">
    <div class="inline-buttons">
      <button onclick="adjustValue('height', 100)">+100 –º</button>
      <button onclick="adjustValue('height', 500)">+500 –º</button>
      <button onclick="adjustValue('height', -100)">-100 –º</button>
      <button onclick="adjustValue('height', -500)">-500 –º</button>
    </div>
  </div>
  <!-- 15. –ß–∞—Å -->
  <div class="group">
    <label>–ß–∞—Å (HH:MM)</label>
    <input type="time" id="time" required>
    <div class="inline-buttons">
      <button onclick="setNowTime()">–©–æ–π–Ω–æ</button>
      <button onclick="adjustTime(1)">+1 —Ö–≤.</button>
      <button onclick="adjustTime(-1)">-1 —Ö–≤.</button>
    </div>
  </div>

  <!-- 16. –í–∏—è–≤ -->
  <div class="group">
    <label>–í–∏—è–≤</label>
    <div class="radio-group">
      <label><input type="checkbox" id="detect1"> –ê–∫—É—Å—Ç–∏—á–Ω–æ</label>
      <label><input type="checkbox" id="detect2"> –†–∞–¥—ñ–æ–ª–æ–∫–∞—Ü—ñ–π–Ω–æ</label>
      <label><input type="checkbox" id="detect3" onchange="checkDetect()"> –í—ñ–∑—É–∞–ª—å–Ω–æ</label>
      <label><input type="checkbox" id="detect4" disabled> –Ü–∑ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è–º –ø—Ä–∏–ª–∞–¥—ñ–≤</label>
    </div>
  </div>

  <!-- 17. –†–µ–∑—É–ª—å—Ç–∞—Ç -->
  <div class="group">
    <label>–†–µ–∑—É–ª—å—Ç–∞—Ç</label>
    <div class="radio-group">
      <label><input type="radio" name="result" value="–í–∏—è–≤–ª–µ–Ω–æ"> –í–∏—è–≤–ª–µ–Ω–æ</label>
      <label><input type="radio" name="result" value="–û–±—Å—Ç—Ä—ñ–ª—è–Ω–æ"> –û–±—Å—Ç—Ä—ñ–ª—è–Ω–æ</label>
      <label><input type="radio" name="result" value="–£—Ä–∞–∂–µ–Ω–æ"> –£—Ä–∞–∂–µ–Ω–æ</label>
    </div>
  </div>

  <!-- 18. –†–æ–∑—Ö—ñ–¥ –ë–ö -->
<div class="group" id="ammoBlock" style="display:none;">
  <label>–†–æ–∑—Ö—ñ–¥ –ë–ö</label>
  <div class="radio-group">
    <div>
      <label>
        <input type="checkbox" onchange="toggleAmmo('ak')"> –ê–ö-74 - 5.45
      </label>
      <input type="number" id="ak" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å" style="display:none;" inputmode="numeric">
    </div>

    <div>
      <label>
        <input type="checkbox" onchange="toggleAmmo('canik')"> CANiK M2
      </label>
      <input type="number" id="canik" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å" style="display:none;" inputmode="numeric">
    </div>

    <div>
      <label>
        <input type="checkbox" onchange="toggleAmmo('dp')"> –î–ü-27 7.62
      </label>
      <input type="number" id="dp" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å" style="display:none;" inputmode="numeric">
    </div>

    <div>
      <label>
        <input type="checkbox" onchange="toggleAmmo('other')"> –Ü–Ω—à–µ
      </label>
      <input type="number" id="other" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å" style="display:none;" inputmode="numeric">
    </div>
  </div>
</div>


  <!-- 19. –û–ø–∏—Å -->
  <div class="group">
    <label>–û–ø–∏—Å</label>
    <div class="radio-group">
      <label><input type="checkbox" id="desc1"> –∑–º—ñ–Ω–∏–ª–∞ –∑–≤—É–∫</label>
      <label><input type="checkbox" id="desc2"> –∑–º—ñ–Ω–∏–ª–∞ –∫—É—Ä—Å</label>
    </div>
    <textarea id="descText" maxlength="360" placeholder="–î–æ–¥–∞—Ç–∫–æ–≤–∏–π –æ–ø–∏—Å (–¥–æ 360 —Å–∏–º–≤–æ–ª—ñ–≤)" style="width:100%; height:80px; font-size:1rem;"></textarea>
  </div>
  <!-- 20. –ú—ñ–Ω—ñ-–∑–≤—ñ—Ç -->
  <div class="group">
    <label>–ú—ñ–Ω—ñ-–∑–≤—ñ—Ç</label>
    <pre id="preview" style="white-space: pre-wrap; background:#fff; padding:0.7rem; border:1px solid #ccc;"></pre>
  </div>

  <!-- 21. –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –∑–≤—ñ—Ç -->
  <div class="group">
    <button onclick="copyReport()">–ö–æ–ø—ñ—é–≤–∞—Ç–∏ –∑–≤—ñ—Ç</button>
  </div>

  <!-- 22. –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤ Signal -->
  <div class="group">
    <a id="signalLink" onclick="copyReport()" style="text-decoration: none;">
      <button>–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≤ Signal</button>
    </a>
  </div>

  <!-- –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–æ–º–ø–∞—Å–∞ -->
  <div class="group">
    <label>üß™ –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–æ–º–ø–∞—Å–∞</label>
    <div id="debug">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö...</div>
  </div>
  <script>
    function toggleLock(id) {
      const input = document.getElementById(id);
      input.readOnly = !input.readOnly;
      if (input.readOnly) localStorage.setItem(id, input.value);
      else input.focus();
    }

    function changeCount(delta) {
      const field = document.getElementById('targetCount');
      let val = parseInt(field.value) + delta;
      if (val <= 1) {
        val = 1;
        document.getElementById('minusBtn').disabled = true;
      } else {
        document.getElementById('minusBtn').disabled = false;
      }
      field.value = val;
    }

    function toggleNumberField() {
      const field = document.getElementById('targetNumber');
      const noNumber = document.getElementById('noNumber').checked;
      field.readOnly = noNumber;
      if (noNumber) field.value = '';
    }

    function adjustValue(id, delta) {
      const field = document.getElementById(id);
      let val = parseInt(field.value) || 0;
      val += delta;
      if (val < 0) val = 0;
      field.value = val;
    }

    function setNowTime() {
      const now = new Date();
      const hh = String(now.getHours()).padStart(2, '0');
      const mm = String(now.getMinutes()).padStart(2, '0');
      document.getElementById("time").value = `${hh}:${mm}`;
    }

    function adjustTime(deltaMinutes) {
      const field = document.getElementById("time");
      if (!field.value) return setNowTime();
      const [hh, mm] = field.value.split(":").map(Number);
      const d = new Date();
      d.setHours(hh);
      d.setMinutes(mm + deltaMinutes);
      const newHH = String(d.getHours()).padStart(2, '0');
      const newMM = String(d.getMinutes()).padStart(2, '0');
      field.value = `${newHH}:${newMM}`;
    }

    function checkDetect() {
      const detect3 = document.getElementById("detect3");
      const detect4 = document.getElementById("detect4");
      detect4.disabled = !detect3.checked;
      if (!detect3.checked) detect4.checked = false;
    }

    function updateAmmoVisibility() {
      const selected = document.querySelector('input[name="result"]:checked')?.value;
      const show = selected === "–û–±—Å—Ç—Ä—ñ–ª—è–Ω–æ" || selected === "–£—Ä–∞–∂–µ–Ω–æ";
      document.getElementById("ammoBlock").style.display = show ? "block" : "none";
    }

    document.querySelectorAll('input[name="result"]').forEach(el => {
      el.addEventListener("change", updateAmmoVisibility);
    });
    function toggleAmmo(id) {
  const field = document.getElementById(id);
  field.style.display = document.getElementById(id).previousElementSibling.querySelector('input[type="checkbox"]').checked
    ? "inline-block"
    : "none";
  if (!document.getElementById(id).previousElementSibling.querySelector('input[type="checkbox"]').checked) {
    field.value = "";
  }
}


    function toggleAmmo(id) {
      const field = document.getElementById(id);
      const checkbox = document.querySelector(`input[value="${field.previousElementSibling.value}"]`);
      field.style.display = checkbox.checked ? "inline-block" : "none";
      if (!checkbox.checked) field.value = "";
    }
    let sensors = {
      azimuth: { active: false, heading: 0, handler: null },
      course: { active: false, heading: 0, handler: null }
    };

    function toggleSensor(type) {
      const field = document.getElementById(type);
      const btn = document.getElementById(type + 'Btn');

      const handler = function(event) {
        let heading = null;
        const dbg = document.getElementById("debug");
        let alpha = event.alpha != null ? event.alpha.toFixed(2) : "null";
        let absolute = event.absolute != null ? event.absolute : "–Ω/–¥";
        let wch = event.webkitCompassHeading !== undefined ? event.webkitCompassHeading.toFixed(2) : "–Ω/–¥";

        if (event.webkitCompassHeading !== undefined) {
          heading = Math.round(event.webkitCompassHeading);
        } else if (event.absolute === true && event.alpha != null) {
          heading = Math.round(360 - event.alpha);
        } else if (event.alpha != null) {
          heading = Math.round(360 - event.alpha);
          dbg.innerHTML = `‚ö†Ô∏è fallback (alpha=${alpha}) ‚Üí ${heading}¬∞ | absolute=${absolute} | wch=${wch}`;
        }

        if (heading != null) {
          sensors[type].heading = heading % 360;
          field.value = sensors[type].heading;
        }
      };

      const startSensor = () => {
        window.addEventListener("deviceorientation", handler, true);
        sensors[type].handler = handler;
        btn.textContent = "–∑–±–µ—Ä–µ–≥—Ç–∏";
        sensors[type].active = true;
      };

      const stopSensor = () => {
        window.removeEventListener("deviceorientation", sensors[type].handler, true);
        field.value = sensors[type].heading;
        btn.textContent = type === "azimuth" ? "–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∞–∑–∏–º—É—Ç" : "–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ö—É—Ä—Å";
        sensors[type].active = false;
      };

      if (!sensors[type].active) {
        if (
          typeof DeviceOrientationEvent !== "undefined" &&
          typeof DeviceOrientationEvent.requestPermission === "function"
        ) {
          DeviceOrientationEvent.requestPermission()
            .then((response) => {
              if (response === "granted") startSensor();
              else alert("‚ö†Ô∏è –î–æ—Å—Ç—É–ø –¥–æ –∫–æ–º–ø–∞—Å–∞ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ.");
            })
            .catch((err) => alert("‚ö†Ô∏è –ù–µ–º–æ–∂–ª–∏–≤–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–º–ø–∞—Å: " + err));
        } else {
          startSensor(); // Android –∞–±–æ —Å—Ç–∞—Ä—ñ Safari
        }
      } else {
        stopSensor();
      }
    }

    function val(id) {
      return document.getElementById(id)?.value || "-";
    }

    function checked(name) {
      return document.querySelector(`input[name="${name}"]:checked`)?.value || "-";
    }

    function checkedBox(id) {
      return document.getElementById(id)?.checked;
    }

    function generateReportText() {
      const P = `${val('sector')}, ${val('position')}`;
      const number = document.getElementById("noNumber").checked ? "–±–µ–∑ –≤–∏–¥–∞—á—ñ" : val('targetNumber');
      const targetType = checked('target');
      const targetSide = checked('side');
      const –¶—ñ–ª—å = `${targetType}, ${targetSide}, ${number}`;
      const –í–∏—Å–æ—Ç–∞ = val('height');
      const –í—ñ–¥—Å—Ç–∞–Ω—å = val('distance');
      const –ö—ñ–ª—å–∫—ñ—Å—Ç—å = val('targetCount');
      const A = val('azimuth') + "¬∞";
      const K = val('course') + "¬∞";
      const –ù–ü = val('location');
      const –ß = val('time');

      let –í–∏—è–≤ = [];
      if (checkedBox("detect1")) –í–∏—è–≤.push("–ê–∫—É—Å—Ç–∏—á–Ω–æ");
      if (checkedBox("detect2")) –í–∏—è–≤.push("–†–õ–°");
      if (checkedBox("detect3")) –í–∏—è–≤.push("–í—ñ–∑—É–∞–ª—å–Ω–æ");
      if (checkedBox("detect4")) –í–∏—è–≤.push("–ü—Ä–∏–ª–∞–¥");

      let –û–ø–∏—Å = "";
      ["ak", "canik", "dp", "other"].forEach(id => {
        const checkbox = document.getElementById(id)?.previousElementSibling;
        const value = document.getElementById(id)?.value;
        if (checkbox?.checked && value) {
          –û–ø–∏—Å += `${checkbox.value}: ${value}, `;
        }
      });

      if (checkedBox("desc1")) –û–ø–∏—Å += "–∑–º—ñ–Ω–∏–ª–∞ –∑–≤—É–∫, ";
      if (checkedBox("desc2")) –û–ø–∏—Å += "–∑–º—ñ–Ω–∏–ª–∞ –∫—É—Ä—Å, ";
      const –¥–æ–ø–∏—Å = document.getElementById("descText").value;
      if (–¥–æ–ø–∏—Å) –û–ø–∏—Å += –¥–æ–ø–∏—Å;

      return `
–ü: ${P}
–¶—ñ–ª—å: ${–¶—ñ–ª—å}
–í–∏—Å–æ—Ç–∞: ${–í–∏—Å–æ—Ç–∞}
–í—ñ–¥—Å—Ç–∞–Ω—å: ${–í—ñ–¥—Å—Ç–∞–Ω—å}
–ö—ñ–ª—å–∫—ñ—Å—Ç—å: ${–ö—ñ–ª—å–∫—ñ—Å—Ç—å}
–ê: ${A}
–ö: ${K}
–ù–ü: ${–ù–ü}
–ß: ${–ß}
–í–∏—è–≤: ${–í–∏—è–≤.join(", ")}
–ü–ü: –í–∏—è–≤–ª–µ–Ω–æ
–û–ø–∏—Å: ${–û–ø–∏—Å.trim().replace(/,\s*$/, "")}
`.trim();
    }

    function copyReport() {
      const text = generateReportText();
      navigator.clipboard.writeText(text).then(() => {
        document.getElementById("preview").textContent = text;
      });
    }

    // –ü–æ—Å—Ç—ñ–π–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–µ–≤'—é
    setInterval(() => {
      document.getElementById("preview").textContent = generateReportText();
    }, 1500);

    function loadStored() {
      ['sector', 'position', 'location'].forEach(id => {
        const v = localStorage.getItem(id);
        if (v) document.getElementById(id).value = v;
      });
    }

    window.onload = () => {
      loadStored();
      toggleNumberField();
      setNowTime();
      updateAmmoVisibility();
    };
  </script>
</body>
</html>
