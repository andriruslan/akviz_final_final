<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>–ê–∫–í—ñ–∑_–ö–ê–ì–ê–†–õ–ò–ö</title>
  <style>
    /* --- –°—Ç–∏–ª—ñ —è–∫ –Ω–∞ akustychno-visualno.vercel.app --- */
    body {
      margin: 0;
      padding: 20px;
      background-color: #121212;
      font-family: 'Consolas', 'Courier New', monospace;
      color: #e0e0e0;
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }
    .container {
      max-width: 480px;
      width: 95vw;
    }
    h2 {
      text-align: center;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: #eee;
      font-family: 'Consolas', monospace;
    }
    .group {
      margin-bottom: 1.2rem;
    }
    label {
      display: block;
      margin-bottom: 0.3rem;
      color: #bbb;
      font-weight: 600;
      font-size: 0.9rem;
    }
    input[type="text"],
    input[type="number"],
    input[type="time"],
    textarea,
    select {
      width: 100%;
      padding: 8px 10px;
      font-size: 1rem;
      background-color: #1e1e1e;
      border: 1px solid #333;
      border-radius: 4px;
      color: #e0e0e0;
      box-sizing: border-box;
      transition: border-color 0.3s;
      font-family: 'Consolas', monospace;
    }
    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #40a9ff;
      background-color: #252525;
    }
    button {
      background-color: #282828;
      color: #e0e0e0;
      border: 1px solid #444;
      border-radius: 4px;
      padding: 8px 12px;
      font-family: 'Consolas', monospace;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s;
      margin-right: 8px;
    }
    button:hover {
      background-color: #3a3a3a;
    }
    .radio-group label {
      display: block;
      cursor: pointer;
      font-weight: normal;
      color: #ccc;
      margin-bottom: 0.2rem;
    }
    .radio-group input[type="radio"],
    .radio-group input[type="checkbox"] {
      margin-right: 8px;
      cursor: pointer;
    }
    .inline-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }
    #preview {
      background-color: #1a1a1a;
      border: 1px solid #333;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
      white-space: pre-wrap;
      color: #ddd;
      min-height: 100px;
      user-select: text;
    }
    textarea {
      resize: vertical;
      background-color: #1e1e1e;
      border: 1px solid #333;
      color: #ddd;
    }
    a {
      color: #40a9ff;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    #debug {
      color: #777;
      font-size: 0.85rem;
      font-family: monospace;
      background-color: #1a1a1a;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #333;
      min-height: 40px;
    }
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å */
    @media (max-width: 520px) {
      body {
        padding: 12px;
      }
      button {
        margin-right: 4px;
        padding: 6px 8px;
        font-size: 0.9rem;
      }
      label {
        font-size: 0.85rem;
      }
    }
    .red-button {
  background-color: #e53935; /* –Ω–∞—Å–∏—á–µ–Ω–∏–π —á–µ—Ä–≤–æ–Ω–∏–π */
  color: white;
  border: none;
  border-radius: 20px; /* –∑–∞–æ–∫—Ä—É–≥–ª–µ–Ω—ñ –∫—Ä–∞—ó */
  padding: 0.4rem 1.2rem;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.3s ease;
  box-shadow: 0 3px 6px rgba(229, 57, 53, 0.5);
}

.red-button:hover {
  background-color: #b71c1c; /* —Ç–µ–º–Ω—ñ—à–∏–π —á–µ—Ä–≤–æ–Ω–∏–π –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–Ω—ñ */
}
/* –ü–ª—é—Å–æ–≤—ñ –∫–Ω–æ–ø–∫–∏ (–∑–µ–ª–µ–Ω—ñ) */
.plus-button {
  background-color: #43a047;
  color: white;
  border: none;
  border-radius: 20px;
  padding: 0.4rem 1.2rem;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.3s ease;
  box-shadow: 0 3px 6px rgba(67, 160, 71, 0.5);
}
.plus-button:hover {
  background-color: #2e7d32;
}

/* –ú—ñ–Ω—É—Å–æ–≤—ñ –∫–Ω–æ–ø–∫–∏ (—á–µ—Ä–≤–æ–Ω—ñ) */
.minus-button {
  background-color: #e53935;
  color: white;
  border: none;
  border-radius: 20px;
  padding: 0.4rem 1.2rem;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.3s ease;
  box-shadow: 0 3px 6px rgba(229, 57, 53, 0.5);
}
.minus-button:hover {
  background-color: #b71c1c;
}
.inline-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  justify-content: flex-start;
  align-items: center;
  margin-top: 0.5rem;
}

.inline-buttons input {
  flex: 1 1 auto;
  min-width: 80px;
}

/* –ü–ª—é—Å–æ–≤—ñ –∫–Ω–æ–ø–∫–∏ (–∑–µ–ª–µ–Ω—ñ) */
.plus-button {
  background-color: #43a047;
  color: white;
  border: none;
  border-radius: 20px;
  padding: 0.4rem 1.2rem;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.3s ease;
  box-shadow: 0 3px 6px rgba(67, 160, 71, 0.5);
  flex: 1 1 auto;
}
.plus-button:hover {
  background-color: #2e7d32;
}

/* –ú—ñ–Ω—É—Å–æ–≤—ñ –∫–Ω–æ–ø–∫–∏ (—á–µ—Ä–≤–æ–Ω—ñ) */
.minus-button {
  background-color: #e53935;
  color: white;
  border: none;
  border-radius: 20px;
  padding: 0.4rem 1.2rem;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.3s ease;
  box-shadow: 0 3px 6px rgba(229, 57, 53, 0.5);
  flex: 1 1 auto;
}
.minus-button:hover {
  background-color: #b71c1c;
}


  </style>
</head>
<body>
  <div class="container">
    <h2>–ê–∫–í—ñ–∑_–ö–ê–ì–ê–†–õ–ò–ö <small style="font-weight:normal;">(–≤–µ—Ä—Å—ñ—è 1.1.3)</small></h2>

    <!-- 1. –ü—ñ–¥–ø–æ—Ä—è–¥–∫—É–≤–∞–Ω–Ω—è -->
    <div class="group">
      <label>–ü—ñ–¥–ø–æ—Ä—è–¥–∫—É–≤–∞–Ω–Ω—è (*)</label>
      <input type="text" id="sector" value="" readonly>
      <button onclick="toggleLock('sector')">üîì/üîí</button>
    </div>

    <!-- 2. –ü–æ–∑–∏—Ü—ñ—è -->
    <div class="group">
      <label>–ü–æ–∑–∏—Ü—ñ—è (*)</label>
      <input type="text" id="position" value="" readonly>
      <button onclick="toggleLock('position')">üîì/üîí</button>
    </div>

    <!-- 3. –ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç -->
    <div class="group">
      <label>–ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç (*)</label>
      <input type="text" id="location" value="" readonly>
      <button onclick="toggleLock('location')">üîì/üîí</button>
    </div>

    <div class="group">
      <label>–¢–∏–ø —Ü—ñ–ª—ñ</label>
      <div class="radio-group">
        <label><input type="radio" name="target" value="–ë–ü–õ–ê –ª—ñ—Ç–∞–∫–æ–≤–æ–≥–æ —Ç–∏–ø—É"> –ë–ü–õ–ê –ª—ñ—Ç–∞–∫–æ–≤–æ–≥–æ —Ç–∏–ø—É</label>
        <label><input type="radio" name="target" value="–ü–æ—Å—Ç—Ä—ñ–ª–∏ (–ó–£, –∫—É–ª–µ–º–µ—Ç)"> –ü–æ—Å—Ç—Ä—ñ–ª–∏ (–ó–£, –∫—É–ª–µ–º–µ—Ç)</label>
        <label><input type="radio" name="target" value="–í–∏—Ö–æ–¥–∏ (–ü–ó–†–ö, –ó–†–ö)"> –í–∏—Ö–æ–¥–∏ (–ü–ó–†–ö, –ó–†–ö)</label>
        <label><input type="radio" name="target" value="–í–∏–±—É—Ö –ö–†"> –í–∏–±—É—Ö –ö–†</label>
        <label><input type="radio" name="target" value="–ì–µ–ª—ñ–∫–æ–ø—Ç–µ—Ä"> –ì–µ–ª—ñ–∫–æ–ø—Ç–µ—Ä</label>
        <label><input type="radio" name="target" value="–õ—ñ—Ç–∞–∫ (–º–∞–ª–∏–π)"> –õ—ñ—Ç–∞–∫ (–º–∞–ª–∏–π)</label>
        <label><input type="radio" name="target" value="–õ—ñ—Ç–∞–∫ (–≤–µ–ª–∏–∫–∏–π)"> –õ—ñ—Ç–∞–∫ (–≤–µ–ª–∏–∫–∏–π)</label>
        <label><input type="radio" name="target" value="–ó–æ–Ω–¥"> –ó–æ–Ω–¥</label>
        <label><input type="radio" name="target" value="–ù–µ–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–µ"> –ù–µ–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–µ</label>
        <label><input type="radio" name="target" value="–Ü–Ω—à–µ"> –Ü–Ω—à–µ</label>
        <label><input type="radio" name="target" value="–ê–µ—Ä–æ—Å—Ç–∞—Ç"> –ê–µ—Ä–æ—Å—Ç–∞—Ç</label>
      </div>
    </div>

    <div class="group">
      <label>–°—Ç–æ—Ä–æ–Ω–∞</label>
      <div class="radio-group">
        <label><input type="radio" name="side" value="–í–æ—Ä–æ–∂–∏–π"> –í–æ—Ä–æ–∂–∏–π</label>
        <label><input type="radio" name="side" value="–°–≤—ñ–π"> –°–≤—ñ–π</label>
        <label><input type="radio" name="side" value="–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∏–π"> –ù–µ–π—Ç—Ä–∞–ª—å–Ω–∏–π</label>
      </div>
    </div>

    <div class="group">
      <label><input type="checkbox" id="noNumber" checked onchange="toggleNumberField()"> –ë–µ–∑ –≤–∏–¥–∞—á—ñ</label>
      <input type="number" id="targetNumber" placeholder="–Ω–æ–º–µ—Ä —Ü—ñ–ª—ñ" readonly>
    </div>

    <div class="group">
      <label>–ù–∞–∑–≤–∞</label>
      <input type="text" id="targetName" placeholder="–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Shahed-136">
      <div class="inline-buttons">
<button class="red-button" onclick="document.getElementById('targetName').value='Shahed-136'">Shahed-136</button>
<button class="red-button" onclick="document.getElementById('targetName').value='–ì–µ—Ä–±–µ—Ä–∞'">–ì–µ—Ä–±–µ—Ä–∞</button>

      </div>
    </div>

   <!-- –ö—ñ–ª—å–∫—ñ—Å—Ç—å, –æ–¥ -->
<div class="group">
  <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å, –æ–¥</label>
  <div class="inline-buttons">
    <input type="number" id="targetCount" value="1" readonly>
    <button class="plus-button" onclick="changeCount(1)">+1 –æ–¥.</button>
    <button class="minus-button" id="minusBtn" onclick="changeCount(-1)" disabled>-1 –æ–¥.</button>
  </div>
</div>

    <!-- 11. –ê–∑–∏–º—É—Ç -->
    <div class="group">
      <label>–ê–∑–∏–º—É—Ç, ¬∞ (*)</label>
      <input type="number" id="azimuth" placeholder="–í–≤–µ–¥—ñ—Ç—å –∞–±–æ –≤–∏–∑–Ω–∞—á—Ç–µ" min="0" max="359" step="1">
      <button type="button" id="azimuthBtn" onclick="toggleSensor('azimuth')">–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∞–∑–∏–º—É—Ç</button>
    </div>

    <!-- 12. –ö—É—Ä—Å -->
    <div class="group">
      <label>–ö—É—Ä—Å, ¬∞ (*)</label>
      <input type="number" id="course" placeholder="–í–≤–µ–¥—ñ—Ç—å –∞–±–æ –≤–∏–∑–Ω–∞—á—Ç–µ" min="0" max="359" step="1">
      <button type="button" id="courseBtn" onclick="toggleSensor('course')">–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ö—É—Ä—Å</button>
    </div>

 <!-- 13. –í—ñ–¥—Å—Ç–∞–Ω—å+, –º -->
<div class="group">
  <label>–í—ñ–¥—Å—Ç–∞–Ω—å+, –º (*)</label>
  <input type="number" id="distance" placeholder="–≤–∏—Å–æ—Ç–∞ –ø—Ä–æ–ª—å–æ—Ç—É —Ü—ñ–ª—ñ">
  <div class="inline-buttons">
    <button class="plus-button" onclick="adjustValue('distance', 100)">+100 –º</button>
    <button class="plus-button" onclick="adjustValue('distance', 1000)">+1000 –º</button>
    <button class="plus-button" onclick="adjustValue('distance', 5000)">+5000 –º</button>
    <button class="minus-button" onclick="adjustValue('distance', -100)">-100 –º</button>
    <button class="minus-button" onclick="adjustValue('distance', -1000)">-1000 –º</button>
    <button class="minus-button" onclick="adjustValue('distance', -5000)">-5000 –º</button>
  </div>
</div>


   <!-- 14. –í–∏—Å–æ—Ç–∞, –º -->
<div class="group">
  <label>–í–∏—Å–æ—Ç–∞, –º</label>
  <input type="number" id="height" placeholder="–≤–∏—Å–æ—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö">
  <div class="inline-buttons">
    <button class="plus-button" onclick="adjustValue('height', 100)">+100 –º</button>
    <button class="plus-button" onclick="adjustValue('height', 500)">+500 –º</button>
    <button class="minus-button" onclick="adjustValue('height', -100)">-100 –º</button>
    <button class="minus-button" onclick="adjustValue('height', -500)">-500 –º</button>
  </div>
</div>


    <!-- 15. –ß–∞—Å -->
    <div class="group">
      <label>–ß–∞—Å</label>
      <input type="time" id="time">
     <div class="inline-buttons">
  <button onclick="setNowTime()">–©–æ–π–Ω–æ</button>
  <button class="plus-button" onclick="adjustTime(1)">+1 —Ö–≤.</button>
  <button class="minus-button" onclick="adjustTime(-1)">-1 —Ö–≤.</button>
</div>

      </div>
    </div>

    <!-- 16. –í–∏—è–≤–ª–µ–Ω–Ω—è -->
    <div class="group">
      <label>–í–∏—è–≤–ª–µ–Ω–Ω—è</label>
      <div class="radio-group">
        <label><input type="checkbox" id="acoustic" onchange="checkDetect()"> –ê–∫—É—Å—Ç–∏—á–Ω–æ</label>
        <label><input type="checkbox" id="radar" onchange="checkDetect()"> –†–∞–¥–∞—Ä</label>
        <label><input type="checkbox" id="visual" onchange="checkDetect()"> –í—ñ–∑—É–∞–ª—å–Ω–æ</label>
        <label><input type="checkbox" id="obs" disabled> –ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∑–∞—Å–æ–±—ñ–≤ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è</label>
      </div>
    </div>

    <!-- 17. –†–µ–∑—É–ª—å—Ç–∞—Ç -->
    <div class="group">
      <label>–†–µ–∑—É–ª—å—Ç–∞—Ç</label>
      <div class="radio-group">
        <label><input type="radio" name="result" value="Detected" onchange="updateAmmoVisibility()"> –í–∏—è–≤–ª–µ–Ω–æ</label>
        <label><input type="radio" name="result" value="Shot at" onchange="updateAmmoVisibility()"> –í–µ–¥–µ—Ç—å—Å—è –≤–æ–≥–æ–Ω—å</label>
        <label><input type="radio" name="result" value="Hit" onchange="updateAmmoVisibility()"> –ü–æ–ø–∞–¥–∞–Ω–Ω—è</label>
      </div>
    </div>

    <!-- 18. –†–æ–∑—Ö—ñ–¥ –ë–ö -->
    <div class="group" id="ammoGroup" style="display:none;">
      <label>–†–æ–∑—Ö—ñ–¥ –ë–ö</label>
      <div class="radio-group">
        <label><input type="checkbox" id="ammo1" onchange="toggleAmmoCount('ammo1')"> –ê–ö-74 - 5.45</label>
        <input type="number" id="ammo1Count" placeholder="—à—Ç" style="width: 70px;" disabled min="0" step="1">
        <br />
        <label><input type="checkbox" id="ammo2" onchange="toggleAmmoCount('ammo2')"> CANiK M2</label>
        <input type="number" id="ammo2Count" placeholder="—à—Ç" style="width: 70px;" disabled min="0" step="1">
        <br />
        <label><input type="checkbox" id="ammo3" onchange="toggleAmmoCount('ammo3')"> –î–ü-27 7.62</label>
        <input type="number" id="ammo3Count" placeholder="—à—Ç" style="width: 70px;" disabled min="0" step="1">
        <br />
        <label><input type="checkbox" id="ammo4" onchange="toggleAmmoCount('ammo4')"> –Ü–Ω—à–µ</label>
        <input type="number" id="ammo4Count" placeholder="—à—Ç" style="width: 70px;" disabled min="0" step="1">
      </div>
    </div>

    <!-- 19. –û–ø–∏—Å -->
    <div class="group">
      <label>–û–ø–∏—Å</label>
      <label><input type="checkbox" id="descSound"> –∑–º—ñ–Ω–µ–Ω–∏–π –∑–≤—É–∫</label>
      <label><input type="checkbox" id="descCourse"> –∑–º—ñ–Ω–µ–Ω–∏–π –∫—É—Ä—Å</label>
      <textarea id="description" maxlength="360" rows="3" placeholder="–î–æ–¥–∞—Ç–∫–æ–≤–∏–π –æ–ø–∏—Å (–¥–æ 360 —Å–∏–º–≤–æ–ª—ñ–≤)"></textarea>
    </div>

    <!-- 20. –ú—ñ–Ω—ñ-–∑–≤—ñ—Ç -->
    <div class="group">
      <label>–ú—ñ–Ω—ñ-–∑–≤—ñ—Ç</label>
      <pre id="preview" style="white-space: pre-wrap;"></pre>
    </div>

    <!-- 21. –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –∑–≤—ñ—Ç -->
    <div class="group">
      <button type="button" onclick="copyReport()">–ö–æ–ø—ñ—é–≤–∞—Ç–∏ –∑–≤—ñ—Ç</button>
    </div>

    <!-- 22. –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤ Signal -->
    <div class="group">
      <button type="button" onclick="sendToSignal()">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≤ Signal</button>
    </div>

    <!-- –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–æ–º–ø–∞—Å–∞ -->
    <div class="group">
      <label>üß™ –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–æ–º–ø–∞—Å–∞</label>
      <div id="debug">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö...</div>
    </div>

  </div> <!-- –∫—ñ–Ω–µ—Ü—å container -->

<script>
  // --- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è/–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ localStorage ---
  function toggleLock(id) {
    const input = document.getElementById(id);
    input.readOnly = !input.readOnly;
    if (input.readOnly) {
      localStorage.setItem(id, input.value);
    } else {
      input.focus();
    }
  }

  function loadStored() {
    ['sector','position','location'].forEach(id => {
      const val = localStorage.getItem(id);
      if (val) document.getElementById(id).value = val;
    });
    toggleNumberField();
  }

  // --- –ó–º—ñ–Ω–∞ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Ü—ñ–ª–µ–π ---
 function changeCount(delta) {
  const field = document.getElementById('targetCount');
  let val = parseInt(field.value) + delta;
  if (val <= 1) {
    val = 1;
    document.getElementById('minusBtn').disabled = true;
  } else {
    document.getElementById('minusBtn').disabled = false;
  }
  field.value = val;
}


  // --- –í–º–∏–∫–∞–Ω–Ω—è/–≤–∏–º–∏–∫–∞–Ω–Ω—è –ø–æ–ª—è –Ω–æ–º–µ—Ä —Ü—ñ–ª—ñ ---
  function toggleNumberField() {
    const noNum = document.getElementById('noNumber').checked;
    const numInput = document.getElementById('targetNumber');
    numInput.readOnly = noNum;
    if (noNum) numInput.value = '';
  }

  // --- –î–æ–¥–∞–≤–∞–Ω–Ω—è/–≤—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è –≤—ñ–¥—Å—Ç–∞–Ω—ñ ---
  function addDistance(val) {
    const input = document.getElementById('distance');
    let current = Number(input.value) || 0;
    current += val;
    if (current < 0) current = 0;
    input.value = current;
  }

  // --- –î–æ–¥–∞–≤–∞–Ω–Ω—è/–≤—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è –≤–∏—Å–æ—Ç–∏ ---
  function addHeight(val) {
    const input = document.getElementById('height');
    let current = Number(input.value) || 0;
    current += val;
    if (current < 0) current = 0;
    input.value = current;
  }

  // --- –ß–∞—Å ---
  function setNowTime() {
    const timeInput = document.getElementById('time');
    const now = new Date();
    const h = now.getHours().toString().padStart(2,'0');
    const m = now.getMinutes().toString().padStart(2,'0');
    timeInput.value = h + ':' + m;
  }

  function changeTime(delta) {
    const timeInput = document.getElementById('time');
    let [h,m] = timeInput.value.split(':').map(Number);
    if (isNaN(h) || isNaN(m)) {
      setNowTime();
      return;
    }
    let date = new Date();
    date.setHours(h, m + delta);
    const nh = date.getHours().toString().padStart(2,'0');
    const nm = date.getMinutes().toString().padStart(2,'0');
    timeInput.value = nh + ':' + nm;
  }

  // --- –í–∏—è–≤–ª–µ–Ω–Ω—è ---
  function checkDetect() {
    const visual = document.getElementById('visual').checked;
    const obs = document.getElementById('obs');
    obs.disabled = !visual;
    if (!visual) obs.checked = false;
  }

  // --- –ü–æ–∫–∞–∑–∞—Ç–∏/—Å—Ö–æ–≤–∞—Ç–∏ –≤–∏—Ç—Ä–∞—Ç—É –±–æ—î–ø—Ä–∏–ø–∞—Å—ñ–≤ ---
  function updateAmmoVisibility() {
    const results = document.getElementsByName('result');
    let show = false;
    results.forEach(r => {
      if ((r.checked) && (r.value === 'Shot at' || r.value === 'Hit')) show = true;
    });
    document.getElementById('ammoGroup').style.display = show ? 'block' : 'none';
  }

  // --- –ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏/–¥–µ–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ –ø–æ–ª—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –±–æ—î–ø—Ä–∏–ø–∞—Å—ñ–≤ ---
  function toggleAmmoCount(id) {
    const cb = document.getElementById(id);
    const countInput = document.getElementById(id + 'Count');
    countInput.disabled = !cb.checked;
    if (!cb.checked) countInput.value = '';
  }

  // --- –§–æ—Ä–º—É–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –∑–≤—ñ—Ç—É ---
  function generateReportText() {
    const sector = document.getElementById('sector').value;
    const position = document.getElementById('position').value;
    const location = document.getElementById('location').value;

    let targetType = '';
    document.querySelectorAll('input[name="target"]').forEach(r => { if(r.checked) targetType = r.value; });

    let side = '';
    document.querySelectorAll('input[name="side"]').forEach(r => { if(r.checked) side = r.value; });

    const noNumber = document.getElementById('noNumber').checked;
    const targetNumber = noNumber ? "–±–µ–∑ –≤–∏–¥–∞—á—ñ" : (document.getElementById('targetNumber').value || '');

    const targetName = document.getElementById('targetName').value;
    const targetCount = document.getElementById('targetCount').value;

    const azimuth = document.getElementById('azimuth').value;
    const course = document.getElementById('course').value;

    const distance = document.getElementById('distance').value;
    const height = document.getElementById('height').value;

    const time = document.getElementById('time').value;

    const acoustic = document.getElementById('acoustic').checked ? "–ê–∫—É—Å—Ç–∏—á–Ω–æ" : "";
    const radar = document.getElementById('radar').checked ? "–†–∞–¥–∞—Ä" : "";
    const visual = document.getElementById('visual').checked ? "–í—ñ–∑—É–∞–ª—å–Ω–æ" : "";
    const obs = document.getElementById('obs').checked ? "–ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∑–∞—Å–æ–±—ñ–≤ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è" : "";

    let resultValue = "";
    document.getElementsByName('result').forEach(r => { if(r.checked) resultValue = r.value; });

    let ammoText = '';
    if (resultValue === 'Shot at' || resultValue === 'Hit') {
      const ammoMap = {
        'ammo1': '–ê–ö-74 - 5.45',
        'ammo2': 'CANiK M2',
        'ammo3': '–î–ü-27 7.62',
        'ammo4': '–Ü–Ω—à–µ'
      };
      for (const key in ammoMap) {
        if (document.getElementById(key).checked) {
          const count = document.getElementById(key + 'Count').value || 0;
          ammoText += `${ammoMap[key]}: ${count} —à—Ç.\n`;
        }
      }
    }

    const descSound = document.getElementById('descSound').checked ? "–∑–º—ñ–Ω–µ–Ω–∏–π –∑–≤—É–∫" : "";
    const descCourse = document.getElementById('descCourse').checked ? "–∑–º—ñ–Ω–µ–Ω–∏–π –∫—É—Ä—Å" : "";
    const description = document.getElementById('description').value;

    let descriptionFull = "";
    if(descSound) descriptionFull += descSound + "; ";
    if(descCourse) descriptionFull += descCourse + "; ";
    if(description) descriptionFull += description;

    let report = `P: ${sector}, ${position}\n`;
    report += `Location: ${location}\n`;
    report += `Target: ${targetType}, ${side}, ${noNumber ? "–±–µ–∑ –≤–∏–¥–∞—á—ñ" : targetNumber}\n`;
    if(targetName) report += `Name: ${targetName}\n`;
    report += `Height: ${height} –º, Distance: ${distance} –º, Quantity: ${targetCount}\n`;
    report += `Azimuth: ${azimuth}¬∞, Course: ${course}¬∞\n`;
    report += `Time: ${time}\n`;
    report += `Detection: ${[acoustic, radar, visual, obs].filter(Boolean).join(', ')}\n`;
    report += `Result: ${resultValue}\n`;
    if(ammoText) report += `Ammo consumption:\n${ammoText}`;
    if(descriptionFull) report += `Description: ${descriptionFull}\n`;
    return report;
  }

  // --- –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –∑–≤—ñ—Ç ---
  function copyReport() {
    const text = generateReportText();
    navigator.clipboard.writeText(text).then(() => {
      document.getElementById("preview").textContent = text;
      /*
      alert('–ó–≤—ñ—Ç —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ –¥–æ –±—É—Ñ–µ—Ä–∞ –æ–±–º—ñ–Ω—É!');
*/
    }).catch(err => {
      alert("–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏: " + err);
    });
  }

  // --- –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤ Signal (–∫–æ–ø—ñ—é—î–º–æ —ñ –≤—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –¥–æ–¥–∞—Ç–æ–∫) ---
  function sendToSignal() {
    const text = generateReportText();
    navigator.clipboard.writeText(text).then(() => {
      document.getElementById("preview").textContent = text;
      window.location.href = "sgnl://";
    }).catch(err => {
      alert("–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –∑–≤—ñ—Ç —É –±—É—Ñ–µ—Ä: " + err);
    });
  }

  // --- –ö–æ–º–ø–∞—Å —ñ –≥—ñ—Ä–æ—Å–∫–æ–ø –¥–ª—è –∞–∑–∏–º—É—Ç—É —ñ –∫—É—Ä—Å—É ---
  let sensorActive = {
    azimuth: false,
    course: false
  };
  let currentField = null;

  function toggleSensor(field) {
    if (sensorActive[field]) {
      // –ó—É–ø–∏–Ω–∏—Ç–∏ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è, –∫–Ω–æ–ø–∫–∞ —Å—Ç–∞—î "–≤–∏–∑–Ω–∞—á–∏—Ç–∏"
      sensorActive[field] = false;
      document.getElementById(field + 'Btn').textContent = field === 'azimuth' ? '–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∞–∑–∏–º—É—Ç' : '–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ö—É—Ä—Å';
      currentField = null;
      window.removeEventListener('deviceorientation', onDeviceOrientation);
      document.getElementById('debug').textContent = '–î–∞–Ω—ñ –∫–æ–º–ø–∞—Å–∞ –∑—É–ø–∏–Ω–µ–Ω–æ.';
    } else {
      // –ó–∞–ø–∏—Ç –¥–æ–∑–≤–æ–ª—É (–¥–ª—è iOS 13+)
      if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
        DeviceOrientationEvent.requestPermission()
          .then(response => {
            if (response === 'granted') {
              startSensor(field);
            } else {
              alert('–î–æ–∑–≤—ñ–ª –Ω–∞ –¥–æ—Å—Ç—É–ø –¥–æ –¥–∞—Ç—á–∏–∫—ñ–≤ –≤—ñ–¥–º–æ–≤–ª–µ–Ω–æ');
            }
          })
          .catch(console.error);
      } else {
        startSensor(field);
      }
    }
  }

  function startSensor(field) {
    sensorActive[field] = true;
    currentField = field;
    document.getElementById(field + 'Btn').textContent = '–∑–±–µ—Ä–µ–≥—Ç–∏';
    window.addEventListener('deviceorientation', onDeviceOrientation);
    document.getElementById('debug').textContent = '–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è ' + (field === 'azimuth' ? '–∞–∑–∏–º—É—Ç—É' : '–∫—É—Ä—Å—É') + ' ...';
  }

  function onDeviceOrientation(event) {
    if (!currentField) return;

    let heading = null;

    // –°–ø—Ä–æ–±–∞ –≤–∑—è—Ç–∏ heading –¥–ª—è iOS (webkitCompassHeading)
    if (event.webkitCompassHeading !== undefined && event.webkitCompassHeading !== null) {
      heading = event.webkitCompassHeading; // 0-360¬∞ (0 ‚Äî –ø—ñ–≤–Ω—ñ—á)
    } else if (event.absolute === true || event.absolute === undefined) {
      // fallback –Ω–∞ event.alpha (–ø—Ä–∏–±–ª–∏–∑–Ω–∏–π azimuth/course)
      // event.alpha ‚Äî 0-360, 0 ‚Äî –ø—ñ–≤–Ω—ñ—á, –ø–æ –≥–æ–¥–∏–Ω–∞—Ö
      heading = 360 - event.alpha; // —ñ–Ω–≤–µ—Ä—Ç—É—î–º–æ –¥–ª—è –±—ñ–ª—å—à –ø—Ä–∏—Ä–æ–¥–Ω–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
      if (heading < 0) heading += 360;
    }

    if (heading !== null) {
      // –û–∫—Ä—É–≥–ª—é—î–º–æ
      heading = Math.round(heading);
      if (heading > 359) heading = 359;

      // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –≤ –ø–æ–ª–µ
      document.getElementById(currentField).value = heading;

      // –í–∏–≤—ñ–¥ –≤ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É
      document.getElementById('debug').textContent = `–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è ${currentField}: ${heading}¬∞`;
    }
  }
  function updatePreview() {
  const preview = document.getElementById('preview');
  preview.textContent = generateReportText();
}

function attachListeners() {
  const inputs = document.querySelectorAll('input, textarea');
  inputs.forEach(input => {
    input.addEventListener('input', updatePreview);
    input.addEventListener('change', updatePreview);
  });
  const radiosAndCheckboxes = document.querySelectorAll('input[type=radio], input[type=checkbox]');
  radiosAndCheckboxes.forEach(el => {
    el.addEventListener('change', updatePreview);
  });
}

window.onload = () => {
  loadStored();
  toggleNumberField();
  setNowTime();
  updateAmmoVisibility();
  checkDetect();
  changeCount(0);
  attachListeners();
  updatePreview();
};



</script>

</body>
</html>
