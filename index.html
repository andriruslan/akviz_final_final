<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>–ê–∫–í—ñ–∑_–ö–ê–ì–ê–†–õ–ò–ö</title>
  <style>
    html, body {
      max-width: 100%;
      overflow-x: hidden;
      margin: 0;
      padding: 20px;
      background-color: #121212;
      font-family: 'Consolas', 'Courier New', monospace;
      color: #e0e0e0;
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }
    .container {
      max-width: 480px;
      width: 95vw;
    }
    h2 {
      text-align: center;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: #eee;
    }
    .group {
      margin-bottom: 1.4rem;
    }
    label {
      display: block;
      font-size: 1.05rem;
      font-weight: bold;
      margin-bottom: 0.3rem;
      color: #ddd;
    }
    hr {
      border: none;
      border-bottom: 1px solid #444;
      margin: 6px 0 10px 0;
    }
    input[type="text"],
    input[type="number"],
    input[type="time"],
    textarea {
      width: 100%;
      padding: 8px 10px;
      font-size: 1rem;
      background-color: #1e1e1e;
      border: 1px solid #333;
      border-radius: 4px;
      color: #e0e0e0;
      box-sizing: border-box;
    }
    input:focus,
    textarea:focus {
      outline: none;
      border-color: #40a9ff;
      background-color: #252525;
    }
    button {
      background-color: #282828;
      color: #e0e0e0;
      border: 1px solid #444;
      border-radius: 4px;
      padding: 8px 12px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s;
      font-family: inherit;
    }
    .plus-button {
      background-color: #1b5e20;
      color: #fff;
      border-radius: 12px;
    }
    .minus-button {
      background-color: #8e0000;
      color: #fff;
      border-radius: 12px;
    }
    .inline-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }
    .inline-buttons .full-width {
      width: 100%;
    }
    .two-rows-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }
    .two-rows-buttons .half-width {
      flex: 1 1 calc(50% - 4px);
    }
    .three-cols {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .three-cols label {
      flex: 1 1 calc(33.333% - 8px);
    }
    .checkbox-inline-group {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .checkbox-inline-group label {
      flex: 1 1 calc(50% - 1rem);
    }
    .ammo-flex {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .ammo-item {
      flex: 1 1 calc(50% - 1rem);
    }
    #preview {
      background-color: #1a1a1a;
      border: 1px solid #333;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
      white-space: pre-wrap;
      color: #ddd;
      min-height: 100px;
      user-select: text;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>–ê–∫–í—ñ–∑_–ö–ê–ì–ê–†–õ–ò–ö</h2>
    <div class="group">
      <label>–ü—ñ–¥–ø–æ—Ä—è–¥–∫—É–≤–∞–Ω–Ω—è</label>
      <hr>
      <input type="text" id="sector" readonly />
      <button onclick="toggleLock('sector')">üîì/üîí</button>
    </div>

    <div class="group">
      <label>–ü–æ–∑–∏—Ü—ñ—è</label>
      <hr>
      <input type="text" id="position" readonly />
      <button onclick="toggleLock('position')">üîì/üîí</button>
    </div>

    <div class="group">
      <label>–ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç</label>
      <hr>
      <input type="text" id="location" readonly />
      <button onclick="toggleLock('location')">üîì/üîí</button>
    </div>

    <div class="group">
      <label>–¢–∏–ø —Ü—ñ–ª—ñ</label>
      <hr>
      <div class="radio-group">
        <label><input type="radio" name="target" value="–ë–ü–õ–ê –ª—ñ—Ç–∞–∫–æ–≤–æ–≥–æ —Ç–∏–ø—É"> –ë–ü–õ–ê –ª—ñ—Ç–∞–∫–æ–≤–æ–≥–æ —Ç–∏–ø—É</label>
        <label><input type="radio" name="target" value="–ü–æ—Å—Ç—Ä—ñ–ª–∏ (–ó–£, –∫—É–ª–µ–º–µ—Ç)"> –ü–æ—Å—Ç—Ä—ñ–ª–∏ (–ó–£, –∫—É–ª–µ–º–µ—Ç)</label>
        <label><input type="radio" name="target" value="–í–∏—Ö–æ–¥–∏ (–ü–ó–†–ö, –ó–†–ö)"> –í–∏—Ö–æ–¥–∏ (–ü–ó–†–ö, –ó–†–ö)</label>
        <label><input type="radio" name="target" value="–í–∏–±—É—Ö –ö–†"> –í–∏–±—É—Ö –ö–†</label>
        <label><input type="radio" name="target" value="–ì–µ–ª—ñ–∫–æ–ø—Ç–µ—Ä"> –ì–µ–ª—ñ–∫–æ–ø—Ç–µ—Ä</label>
        <label><input type="radio" name="target" value="–õ—ñ—Ç–∞–∫ (–º–∞–ª–∏–π)"> –õ—ñ—Ç–∞–∫ (–º–∞–ª–∏–π)</label>
        <label><input type="radio" name="target" value="–õ—ñ—Ç–∞–∫ (–≤–µ–ª–∏–∫–∏–π)"> –õ—ñ—Ç–∞–∫ (–≤–µ–ª–∏–∫–∏–π)</label>
        <label><input type="radio" name="target" value="–ó–æ–Ω–¥"> –ó–æ–Ω–¥</label>
        <label><input type="radio" name="target" value="–ù–µ–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–µ"> –ù–µ–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–µ</label>
        <label><input type="radio" name="target" value="–ê–µ—Ä–æ—Å—Ç–∞—Ç"> –ê–µ—Ä–æ—Å—Ç–∞—Ç</label>
        <label><input type="radio" name="target" value="–Ü–Ω—à–µ"> –Ü–Ω—à–µ</label>
      </div>
    </div>

    <div class="group">
      <label>–°—Ç–æ—Ä–æ–Ω–∞</label>
      <hr>
      <div class="radio-group three-cols">
        <label><input type="radio" name="side" value="–í–æ—Ä–æ–∂–∏–π"> –í–æ—Ä–æ–∂–∏–π</label>
        <label><input type="radio" name="side" value="–°–≤—ñ–π"> –°–≤—ñ–π</label>
        <label><input type="radio" name="side" value="–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∏–π"> –ù–µ–π—Ç—Ä–∞–ª—å–Ω–∏–π</label>
      </div>
    </div>

    <div class="group">
      <label>–ù–æ–º–µ—Ä —Ü—ñ–ª—ñ</label>
      <hr>
      <label><input type="checkbox" id="noNumber" checked onchange="toggleNumberField()"> –ë–µ–∑ –≤–∏–¥–∞—á—ñ</label>
      <input type="number" id="targetNumber" inputmode="numeric" pattern="[0-9]*" placeholder="–≤–∫–∞–∂—ñ—Ç—å –Ω–æ–º–µ—Ä" readonly />
    </div>
    <div class="group">
      <label>–ù–∞–∑–≤–∞</label>
      <hr>
      <input type="text" id="targetName" placeholder="–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Shahed-136" />
      <div class="inline-buttons">
        <button class="minus-button" onclick="setTargetNameAndUpdate('Shahed-136')">Shahed-136</button>
        <button class="minus-button" onclick="setTargetNameAndUpdate('–ì–µ—Ä–±–µ—Ä–∞')">–ì–µ—Ä–±–µ—Ä–∞</button>
      </div>
    </div>

    <div class="group">
      <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å, –æ–¥</label>
      <hr>
      <input type="number" id="targetCount" inputmode="numeric" pattern="[0-9]*" value="1" readonly />
      <div class="inline-buttons">
        <button class="plus-button" onclick="changeCount(1)">+1 –æ–¥.</button>
        <button class="minus-button" id="minusBtn" onclick="changeCount(-1)">-1 –æ–¥.</button>
      </div>
    </div>

    <div class="group">
      <label>–ê–∑–∏–º—É—Ç, ¬∞</label>
      <hr>
      <input type="number" id="azimuth" inputmode="numeric" pattern="[0-9]*" placeholder="–í–≤–µ–¥—ñ—Ç—å –∞–±–æ –≤–∏–∑–Ω–∞—á—Ç–µ">
      <button class="plus-button" id="azimuthBtn" onclick="toggleSensor('azimuth')">–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∞–∑–∏–º—É—Ç</button>
    </div>

    <div class="group">
      <label>–ö—É—Ä—Å, ¬∞</label>
      <hr>
      <input type="number" id="course" inputmode="numeric" pattern="[0-9]*" placeholder="–í–≤–µ–¥—ñ—Ç—å –∞–±–æ –≤–∏–∑–Ω–∞—á—Ç–µ">
      <button class="plus-button" id="courseBtn" onclick="toggleSensor('course')">–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ö—É—Ä—Å</button>
    </div>

    <div class="group">
      <label>–í—ñ–¥—Å—Ç–∞–Ω—å+, –º</label>
      <hr>
      <input type="number" id="distance" inputmode="numeric" pattern="[0-9]*" placeholder="–≤–∏—Å–æ—Ç–∞ –ø—Ä–æ–ª—å–æ—Ç—É —Ü—ñ–ª—ñ">
      <div class="two-rows-buttons">
        <button class="plus-button half-width" onclick="adjustValue('distance', 100)">+100 –º</button>
        <button class="plus-button half-width" onclick="adjustValue('distance', 1000)">+1000 –º</button>
        <button class="plus-button half-width" onclick="adjustValue('distance', 5000)">+5000 –º</button>
        <button class="minus-button half-width" onclick="adjustValue('distance', -100)">-100 –º</button>
        <button class="minus-button half-width" onclick="adjustValue('distance', -1000)">-1000 –º</button>
        <button class="minus-button half-width" onclick="adjustValue('distance', -5000)">-5000 –º</button>
      </div>
    </div>

    <div class="group">
      <label>–í–∏—Å–æ—Ç–∞, –º</label>
      <hr>
      <input type="number" id="height" inputmode="numeric" pattern="[0-9]*" placeholder="–≤–∏—Å–æ—Ç–∞ —Ü—ñ–ª—ñ">
      <div class="two-rows-buttons">
        <button class="plus-button half-width" onclick="adjustValue('height', 100)">+100 –º</button>
        <button class="plus-button half-width" onclick="adjustValue('height', 500)">+500 –º</button>
        <button class="minus-button half-width" onclick="adjustValue('height', -100)">-100 –º</button>
        <button class="minus-button half-width" onclick="adjustValue('height', -500)">-500 –º</button>
      </div>
    </div>
    <div class="group">
      <label>–ß–∞—Å (HH:MM)</label>
      <hr>
      <input type="time" id="time" />
      <div class="inline-buttons">
        <button class="plus-button" onclick="setNowTime()">–©–æ–π–Ω–æ</button>
        <button class="plus-button" onclick="changeTime(1)">+1 —Ö–≤.</button>
        <button class="minus-button" onclick="changeTime(-1)">-1 —Ö–≤.</button>
      </div>
    </div>

    <div class="group">
      <label>–í–∏—è–≤–ª–µ–Ω–Ω—è</label>
      <hr>
      <div class="checkbox-inline-group">
        <label><input type="checkbox" id="acoustic"> –ê–∫—É—Å—Ç–∏—á–Ω–æ</label>
        <label><input type="checkbox" id="radar"> –†–∞–¥—ñ–æ–ª–æ–∫–∞—Ü—ñ–π–Ω–æ</label>
        <label><input type="checkbox" id="visual" onchange="checkDetect()"> –í—ñ–∑—É–∞–ª—å–Ω–æ</label>
        <label><input type="checkbox" id="obs" disabled> –ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∑–∞—Å–æ–±—ñ–≤</label>
      </div>
    </div>

    <div class="group">
      <label>–†–µ–∑—É–ª—å—Ç–∞—Ç</label>
      <hr>
      <div class="three-cols">
        <label><input type="radio" name="result" value="–í–∏—è–≤–ª–µ–Ω–æ"> –í–∏—è–≤–ª–µ–Ω–æ</label>
        <label><input type="radio" name="result" value="–û–±—Å—Ç—Ä—ñ–ª—è–Ω–æ"> –û–±—Å—Ç—Ä—ñ–ª—è–Ω–æ</label>
        <label><input type="radio" name="result" value="–£—Ä–∞–∂–µ–Ω–æ"> –£—Ä–∞–∂–µ–Ω–æ</label>
      </div>
    </div>

    <div class="group" id="ammoGroup" style="display: none;">
      <label>–†–æ–∑—Ö—ñ–¥ –ë–ö</label>
      <hr>
      <div class="ammo-flex">
        <div class="ammo-item">
          <label><input type="checkbox" id="ammo1" onchange="toggleAmmoCount('ammo1')"> –ê–ö-74 - 5.45</label>
          <input type="number" id="ammo1Count" inputmode="numeric" pattern="[0-9]*" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å" disabled>
        </div>
        <div class="ammo-item">
          <label><input type="checkbox" id="ammo2" onchange="toggleAmmoCount('ammo2')"> CANiK M2</label>
          <input type="number" id="ammo2Count" inputmode="numeric" pattern="[0-9]*" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å" disabled>
        </div>
        <div class="ammo-item">
          <label><input type="checkbox" id="ammo3" onchange="toggleAmmoCount('ammo3')"> –î–ü-27 7.62</label>
          <input type="number" id="ammo3Count" inputmode="numeric" pattern="[0-9]*" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å" disabled>
        </div>
        <!--
        <div class="ammo-item">
          <label><input type="checkbox" id="ammo4" onchange="toggleAmmoCount('ammo4')"> –Ü–Ω—à–µ</label>
          <input type="number" id="ammo4Count" inputmode="numeric" pattern="[0-9]*" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å" disabled>
        </div>
        -->
      </div>
    </div>
    <div class="group">
      <label>–û–ø–∏—Å</label>
      <hr>
      <div class="checkbox-inline-group">
        <label><input type="checkbox" id="descSound"> –∑–º—ñ–Ω–∏–≤ –∑–≤—É–∫</label>
        <label><input type="checkbox" id="descCourse"> –∑–º—ñ–Ω–∏–≤ –∫—É—Ä—Å</label>
      </div>
      <textarea id="description" maxlength="360" placeholder="–î–æ–¥–∞—Ç–∫–æ–≤–∏–π –æ–ø–∏—Å (–¥–æ 360 —Å–∏–º–≤–æ–ª—ñ–≤)"></textarea>
    </div>

    <div class="group">
      <label>–ú—ñ–Ω—ñ-–∑–≤—ñ—Ç</label>
      <hr>
      <pre id="preview"></pre>
    </div>

    <div class="group">
      <div class="inline-buttons">
        <button class="plus-button full-width" onclick="copyReport()">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –∑–≤—ñ—Ç</button>
        <button class="plus-button full-width" onclick="sendToSignal()">üì® –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≤ Signal</button>
      </div>
    </div>

    <div class="group">
      <label>üß≠ –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–æ–º–ø–∞—Å–∞</label>
      <hr>
      <div id="debug">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö...</div>
    </div>

  </div> <!-- end .container -->



<script>
  <script>
  // üîí –ó–∞–º–∫–∏ (–ª–æ–∫–∞–ª—å–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è)
  function toggleLock(id) {
    const input = document.getElementById(id);
    input.readOnly = !input.readOnly;
    if (input.readOnly) localStorage.setItem(id, input.value);
    else input.focus();
  }

  function loadStored() {
    ['sector','position','location'].forEach(id => {
      const val = localStorage.getItem(id);
      if (val) document.getElementById(id).value = val;
    });
  }

  // üéØ –ö—ñ–ª—å–∫—ñ—Å—Ç—å
  function changeCount(delta) {
    const field = document.getElementById('targetCount');
    let val = parseInt(field.value) || 1;
    val += delta;
    if (val < 1) val = 1;
    field.value = val;
    document.getElementById("minusBtn").disabled = val <= 1;
    updatePreview();
  }

  // ‚úÖ –ë–µ–∑ –≤–∏–¥–∞—á—ñ
  function toggleNumberField() {
    const cb = document.getElementById('noNumber');
    const input = document.getElementById('targetNumber');
    input.readOnly = cb.checked;
    if (cb.checked) input.value = '';
    updatePreview();
  }

  // ‚è±Ô∏è –ß–∞—Å
  function setNowTime() {
    const now = new Date();
    const h = now.getHours().toString().padStart(2,'0');
    const m = now.getMinutes().toString().padStart(2,'0');
    document.getElementById('time').value = `${h}:${m}`;
    updatePreview();
  }

  function changeTime(delta) {
    const input = document.getElementById('time');
    let [h,m] = input.value.split(':').map(Number);
    if (isNaN(h) || isNaN(m)) return setNowTime();
    const d = new Date();
    d.setHours(h);
    d.setMinutes(m + delta);
    const nh = d.getHours().toString().padStart(2,'0');
    const nm = d.getMinutes().toString().padStart(2,'0');
    input.value = `${nh}:${nm}`;
    updatePreview();
  }

  // üëÄ –í–∏—è–≤–ª–µ–Ω–Ω—è
  function checkDetect() {
    const obs = document.getElementById('obs');
    obs.disabled = !document.getElementById('visual').checked;
    if (obs.disabled) obs.checked = false;
    updatePreview();
  }

  // üî´ –†–æ–∑—Ö—ñ–¥ –ë–ö
  function updateAmmoVisibility() {
    const result = document.querySelector('input[name="result"]:checked')?.value;
    const show = result === "–û–±—Å—Ç—Ä—ñ–ª—è–Ω–æ" || result === "–£—Ä–∞–∂–µ–Ω–æ";
    const group = document.getElementById('ammoGroup');
    if (group) group.style.display = show ? 'block' : 'none';
    updatePreview();
  }

  function toggleAmmoCount(id) {
    const cb = document.getElementById(id);
    const input = document.getElementById(id + 'Count');
    input.disabled = !cb.checked;
    if (!cb.checked) input.value = '';
    updatePreview();
  }

  // üìå –ó–Ω–∞—á–µ–Ω–Ω—è –∑–∞ + / -
  function adjustValue(id, delta) {
    const field = document.getElementById(id);
    let val = parseInt(field.value) || 0;
    val += delta;
    if (val < 0) val = 0;
    field.value = val;
    updatePreview();
  }

  function setTargetNameAndUpdate(name) {
    document.getElementById('targetName').value = name;
    updatePreview();
  }

  // üìã –ó–≤—ñ—Ç
  function generateReportText() {
    const val = id => document.getElementById(id)?.value || "";
    const cb = id => document.getElementById(id)?.checked;

    const P = `${val('sector')}, ${val('position')}`;
    const –¶—ñ–ª—å = `${document.querySelector('input[name="target"]:checked')?.value || '-'}, ${document.querySelector('input[name="side"]:checked')?.value || '-'}, ${cb('noNumber') ? '–±–µ–∑ –≤–∏–¥–∞—á—ñ' : val('targetNumber')}`;
    const –í–∏—Å–æ—Ç–∞ = `${val('height')} –º`;
    const –í—ñ–¥—Å—Ç–∞–Ω—å = `${val('distance')} –º`;
    const –ö—ñ–ª—å–∫—ñ—Å—Ç—å = `${val('targetCount')} –æ–¥`;
    const A = `${val('azimuth')}¬∞`;
    const K = `${val('course')}¬∞`;
    const –ù–ü = val('location');
    const –ß–∞—Å = val('time');

    const –í–∏—è–≤–ª–µ–Ω–Ω—è = [
      cb('acoustic') ? '–ê–∫—É—Å—Ç–∏—á–Ω–æ' : '',
      cb('radar') ? '–†–õ–°' : '',
      cb('visual') ? '–í—ñ–∑—É–∞–ª—å–Ω–æ' : '',
      cb('obs') ? '–ü—Ä–∏–ª–∞–¥' : ''
    ].filter(Boolean).join(', ');

    const –ü–ü = document.querySelector('input[name="result"]:checked')?.value || "";

    let ammoText = '';
    if (–ü–ü === "–û–±—Å—Ç—Ä—ñ–ª—è–Ω–æ" || –ü–ü === "–£—Ä–∞–∂–µ–Ω–æ") {
      const ammo = [
        { id: 'ammo1', label: '–ê–ö-74 - 5.45' },
        { id: 'ammo2', label: 'CANiK M2' },
        { id: 'ammo3', label: '–î–ü-27 7.62' }
        // { id: 'ammo4', label: '–Ü–Ω—à–µ' } // –∑–∞–∫–æ–º–µ–Ω—Ç–æ–≤–∞–Ω–æ
      ];
      ammo.forEach(({id, label}) => {
        if (cb(id)) {
          const count = val(id + 'Count') || '0';
          ammoText += `${label}: ${count}\n`;
        }
      });
    }

    let –æ–ø–∏—Å = [];
    if (cb('descSound')) –æ–ø–∏—Å.push('–∑–º—ñ–Ω–µ–Ω–∏–π –∑–≤—É–∫');
    if (cb('descCourse')) –æ–ø–∏—Å.push('–∑–º—ñ–Ω–µ–Ω–∏–π –∫—É—Ä—Å');
    if (val('description')) –æ–ø–∏—Å.push(val('description'));

    return `
–ü: ${P}
–¶—ñ–ª—å: ${–¶—ñ–ª—å}
–í–∏—Å–æ—Ç–∞: ${–í–∏—Å–æ—Ç–∞}
–í—ñ–¥—Å—Ç–∞–Ω—å: ${–í—ñ–¥—Å—Ç–∞–Ω—å}
–ö—ñ–ª—å–∫—ñ—Å—Ç—å: ${–ö—ñ–ª—å–∫—ñ—Å—Ç—å}
–ê: ${A}
–ö: ${K}
–ù–ü: ${–ù–ü}
–ß–∞—Å: ${–ß–∞—Å}
–í–∏—è–≤: ${–í–∏—è–≤–ª–µ–Ω–Ω—è}
–ü–ü: ${–ü–ü}
${ammoText ? '–†–æ–∑—Ö—ñ–¥ –ë–ö:\n' + ammoText : ''}${–æ–ø–∏—Å.length ? '–û–ø–∏—Å: ' + –æ–ø–∏—Å.join('; ') : ''}
`.trim();
  }

  function updatePreview() {
    document.getElementById('preview').textContent = generateReportText();
  }

  function copyReport() {
    const text = generateReportText();
    navigator.clipboard.writeText(text).then(() => {
      updatePreview();
    });
  }

  function sendToSignal() {
    const text = generateReportText();
    navigator.clipboard.writeText(text).then(() => {
      updatePreview();
      window.location.href = 'sgnl://';
    });
  }

  // üß≠ –ö–æ–º–ø–∞—Å
  let currentField = null;
  let sensorActive = { azimuth: false, course: false };

  function toggleSensor(field) {
    const btn = document.getElementById(field + 'Btn');
    if (sensorActive[field]) {
      sensorActive[field] = false;
      currentField = null;
      window.removeEventListener("deviceorientation", onOrientation);
      btn.textContent = field === 'azimuth' ? "–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∞–∑–∏–º—É—Ç" : "–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ö—É—Ä—Å";
      return;
    }

    const start = () => {
      currentField = field;
      sensorActive[field] = true;
      btn.textContent = "–∑–±–µ—Ä–µ–≥—Ç–∏";
      window.addEventListener("deviceorientation", onOrientation);
    };

    if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
      DeviceOrientationEvent.requestPermission().then(res => {
        if (res === 'granted') start();
        else alert("‚ùó –ù–µ–º–∞—î –¥–æ–∑–≤–æ–ª—É –Ω–∞ –∫–æ–º–ø–∞—Å.");
      }).catch(console.error);
    } else start();
  }

  function onOrientation(e) {
    if (!currentField) return;
    let deg = e.webkitCompassHeading || (360 - e.alpha);
    if (deg < 0) deg += 360;
    const rounded = Math.round(deg);
    document.getElementById(currentField).value = rounded;
    document.getElementById('debug').textContent = `${currentField}: ${rounded}¬∞`;
    updatePreview();
  }

  // üß† –í—ñ–¥—Å–ª—ñ–¥–∫–æ–≤—É–≤–∞–Ω–Ω—è
  function attachListeners() {
    const all = document.querySelectorAll('input, textarea, select');
    all.forEach(el => {
      el.addEventListener("input", updatePreview);
      el.addEventListener("change", updatePreview);
    });
  }

  // üöÄ –ü—É—Å–∫
  window.onload = () => {
    loadStored();
    toggleNumberField();
    setNowTime();
    checkDetect();
    updateAmmoVisibility();
    attachListeners();
    updatePreview();
    document.querySelectorAll("button").forEach(btn =>
      btn.addEventListener("dblclick", e => e.preventDefault())
    );
  };


/*// --- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ –¥–æ localStorage ---
function toggleLock(id) {
  const input = document.getElementById(id);
  input.readOnly = !input.readOnly;
  if (input.readOnly) {
    localStorage.setItem(id, input.value);
  } else {
    input.focus();
  }
}

function loadStored() {
  ['sector','position','location'].forEach(id => {
    const val = localStorage.getItem(id);
    if (val) document.getElementById(id).value = val;
  });
  toggleNumberField();
}

// --- –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ü—ñ–ª–µ–π ---
function changeCount(delta) {
  const field = document.getElementById('targetCount');
  let val = parseInt(field.value) + delta;
  if (val <= 1) {
    val = 1;
    document.getElementById('minusBtn').disabled = true;
  } else {
    document.getElementById('minusBtn').disabled = false;
  }
  field.value = val;
  updatePreview();
}

// --- –ù–æ–º–µ—Ä —Ü—ñ–ª—ñ: –≤–∏–º–∫–Ω–µ–Ω–Ω—è –ø–æ–ª—è –ø—Ä–∏ "–ë–µ–∑ –≤–∏–¥–∞—á—ñ" ---
function toggleNumberField() {
  const noNum = document.getElementById('noNumber').checked;
  const numInput = document.getElementById('targetNumber');
  numInput.readOnly = noNum;
  if (noNum) numInput.value = '';
  updatePreview();
}

// --- –î–æ–¥–∞–≤–∞–Ω–Ω—è/–≤—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è –∑–Ω–∞—á–µ–Ω–Ω—è
function adjustValue(id, delta) {
  const field = document.getElementById(id);
  let val = parseInt(field.value) || 0;
  val += delta;
  if (val < 0) val = 0;
  field.value = val;
  updatePreview();
}

// --- –ß–∞—Å
function setNowTime() {
  const now = new Date();
  const h = now.getHours().toString().padStart(2, '0');
  const m = now.getMinutes().toString().padStart(2, '0');
  document.getElementById('time').value = `${h}:${m}`;
  updatePreview();
}

function changeTime(delta) {
  const timeInput = document.getElementById('time');
  let [h,m] = timeInput.value.split(':').map(Number);
  if (isNaN(h) || isNaN(m)) return setNowTime();
  let date = new Date();
  date.setHours(h, m + delta);
  const nh = date.getHours().toString().padStart(2,'0');
  const nm = date.getMinutes().toString().padStart(2,'0');
  timeInput.value = `${nh}:${nm}`;
  updatePreview();
}

// --- –í–∏—è–≤–ª–µ–Ω–Ω—è
function checkDetect() {
  const visual = document.getElementById('visual').checked;
  const obs = document.getElementById('obs');
  obs.disabled = !visual;
  if (!visual) obs.checked = false;
  updatePreview();
}

// --- –†–æ–∑—Ö—ñ–¥ –ë–ö: –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
function updateAmmoVisibility() {
  const results = document.getElementsByName('result');
  let show = false;
  results.forEach(r => {
    if ((r.checked) && (r.value === '–û–±—Å—Ç—Ä—ñ–ª—è–Ω–æ' || r.value === '–£—Ä–∞–∂–µ–Ω–æ')) show = true;
  });
  const ammoGroup = document.getElementById('ammoGroup');
  if (ammoGroup) ammoGroup.style.display = show ? 'block' : 'none';
}

// --- –ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏/–¥–µ–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ –ø–æ–ª—è –±–æ—î–ø—Ä–∏–ø–∞—Å—ñ–≤
function toggleAmmoCount(id) {
  const cb = document.getElementById(id);
  const countInput = document.getElementById(id + 'Count');
  countInput.disabled = !cb.checked;
  if (!cb.checked) countInput.value = '';
  updatePreview();
}

// --- –§–æ—Ä–º—É–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –∑–≤—ñ—Ç—É ---
function generateReportText() {
  const sector = document.getElementById('sector').value;
  const position = document.getElementById('position').value;
  const location = document.getElementById('location').value;

  let targetType = '';
  document.querySelectorAll('input[name="target"]').forEach(r => { if(r.checked) targetType = r.value; });

  let side = '';
  document.querySelectorAll('input[name="side"]').forEach(r => { if(r.checked) side = r.value; });

  const noNumber = document.getElementById('noNumber').checked;
  const targetNumber = noNumber ? "–±–µ–∑ –≤–∏–¥–∞—á—ñ" : (document.getElementById('targetNumber').value || '');

  const targetName = document.getElementById('targetName').value;
  const targetCount = document.getElementById('targetCount').value;

  const azimuth = document.getElementById('azimuth').value;
  const course = document.getElementById('course').value;
  const distance = document.getElementById('distance').value;
  const height = document.getElementById('height').value;
  const time = document.getElementById('time').value;

  const acoustic = document.getElementById('acoustic').checked ? "–ê–∫—É—Å—Ç–∏—á–Ω–æ" : "";
  const radar = document.getElementById('radar').checked ? "–†–∞–¥–∞—Ä" : "";
  const visual = document.getElementById('visual').checked ? "–í—ñ–∑—É–∞–ª—å–Ω–æ" : "";
  const obs = document.getElementById('obs').checked ? "–ó–∞—Å–æ–±–∏ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è" : "";

  let resultValue = "";
  document.getElementsByName('result').forEach(r => { if(r.checked) resultValue = r.value; });

  let ammoText = '';
  if (resultValue === '–û–±—Å—Ç—Ä—ñ–ª—è–Ω–æ' || resultValue === '–£—Ä–∞–∂–µ–Ω–æ') {
    const ammoMap = {
      'ammo1': '–ê–ö-74 - 5.45',
      'ammo2': 'CANiK M2',
      'ammo3': '–î–ü-27 7.62',
      // 'ammo4': '–Ü–Ω—à–µ' // –∑–∞–∫–æ–º–µ–Ω—Ç–æ–≤–∞–Ω–æ –∑–≥—ñ–¥–Ω–æ –∑ –≤–∏–º–æ–≥–∞–º–∏
    };
    for (const key in ammoMap) {
      if (document.getElementById(key)?.checked) {
        const count = document.getElementById(key + 'Count').value || 0;
        ammoText += `${ammoMap[key]}: ${count} —à—Ç.\n`;
      }
    }
  }

  const descSound = document.getElementById('descSound').checked ? "–∑–º—ñ–Ω–µ–Ω–∏–π –∑–≤—É–∫" : "";
  const descCourse = document.getElementById('descCourse').checked ? "–∑–º—ñ–Ω–µ–Ω–∏–π –∫—É—Ä—Å" : "";
  const description = document.getElementById('description').value;
  let descriptionFull = [descSound, descCourse, description].filter(Boolean).join('; ');

  let report = `–ü: ${sector}, ${position}\n`;
  report += `–¶—ñ–ª—å: ${targetType}, ${side}, ${noNumber ? "–±–µ–∑ –≤–∏–¥–∞—á—ñ" : targetNumber}\n`;
  if (targetName) report += `–ù–∞–∑–≤–∞: ${targetName}\n`;
  report += `–í–∏—Å–æ—Ç–∞: ${height} –º\n`;
  report += `–í—ñ–¥—Å—Ç–∞–Ω—å: ${distance} –º\n`;
  report += `–ö—ñ–ª—å–∫—ñ—Å—Ç—å: ${targetCount} –æ–¥\n`;
  report += `–ê: ${azimuth}¬∞\n`;
  report += `–ö: ${course}¬∞\n`;
  report += `–ù–ü: ${location}\n`;
  report += `–ß–∞—Å: ${time}\n`;
  report += `–í–∏—è–≤: ${[acoustic, radar, visual, obs].filter(Boolean).join(', ')}\n`;
  report += `–ü–ü: ${resultValue}\n`;
  if (ammoText) report += `–†–æ–∑—Ö—ñ–¥ –ë:\n${ammoText}`;
  if (descriptionFull) report += `–û–ø–∏—Å: ${descriptionFull}\n`;

  return report;
}

// --- –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∑–≤—ñ—Ç—É ---
function copyReport() {
  const text = generateReportText();
  navigator.clipboard.writeText(text).then(() => {
    document.getElementById("preview").textContent = text;
  });
}

// --- –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤ Signal ---
function sendToSignal() {
  const text = generateReportText();
  navigator.clipboard.writeText(text).then(() => {
    document.getElementById("preview").textContent = text;
    window.location.href = "sgnl://";
  });
}

// --- –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∞–∑–∏–º—É—Ç—É / –∫—É—Ä—Å—É ---
let sensorActive = { azimuth: false, course: false };
let currentField = null;

function toggleSensor(field) {
  if (sensorActive[field]) {
    sensorActive[field] = false;
    document.getElementById(field + 'Btn').textContent = field === 'azimuth' ? '–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∞–∑–∏–º—É—Ç' : '–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ö—É—Ä—Å';
    currentField = null;
    window.removeEventListener('deviceorientation', onDeviceOrientation);
    document.getElementById('debug').textContent = '–î–∞–Ω—ñ –∫–æ–º–ø–∞—Å–∞ –∑—É–ø–∏–Ω–µ–Ω–æ.';
  } else {
    if (typeof DeviceOrientationEvent !== 'undefined' &&
        typeof DeviceOrientationEvent.requestPermission === 'function') {
      DeviceOrientationEvent.requestPermission().then(response => {
        if (response === 'granted') startSensor(field);
        else alert('–î–æ—Å—Ç—É–ø –¥–æ –¥–∞—Ç—á–∏–∫—ñ–≤ –≤—ñ–¥–º–æ–≤–ª–µ–Ω–æ.');
      }).catch(console.error);
    } else {
      startSensor(field);
    }
  }
}

function startSensor(field) {
  sensorActive[field] = true;
  currentField = field;
  document.getElementById(field + 'Btn').textContent = '–∑–±–µ—Ä–µ–≥—Ç–∏';
  window.addEventListener('deviceorientation', onDeviceOrientation);
  document.getElementById('debug').textContent = '–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è ' + (field === 'azimuth' ? '–∞–∑–∏–º—É—Ç—É' : '–∫—É—Ä—Å—É') + '...';
}

function onDeviceOrientation(event) {
  if (!currentField) return;
  let heading = event.webkitCompassHeading ?? (event.absolute !== false ? 360 - event.alpha : null);
  if (heading !== null) {
    heading = Math.round(heading);
    if (heading > 359) heading = 359;
    document.getElementById(currentField).value = heading;
    document.getElementById('debug').textContent = `–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è ${currentField}: ${heading}¬∞`;
    updatePreview();
  }
}

// --- –Ü–Ω—à—ñ –¥–æ–ø–æ–º—ñ–∂–Ω—ñ ---
function setTargetNameAndUpdate(name) {
  const targetNameInput = document.getElementById('targetName');
  targetNameInput.value = name;
  updatePreview();
}

function updatePreview() {
  document.getElementById("preview").textContent = generateReportText();
}

function attachReportUpdateListeners() {
  const inputs = document.querySelectorAll("input, textarea, select");
  inputs.forEach(el => {
    el.addEventListener("input", updatePreview);
    if (el.type === "checkbox" || el.type === "radio") {
      el.addEventListener("change", updatePreview);
    }
  });
}

document.querySelectorAll("button").forEach(btn => {
  btn.addEventListener("dblclick", e => e.preventDefault());
});

window.onload = () => {
  loadStored();
  toggleNumberField();
  setNowTime();
  updateAmmoVisibility();
  checkDetect();
  attachReportUpdateListeners();
  updatePreview();
  document.querySelectorAll('input[name="result"]').forEach(el => {
    el.addEventListener("change", updateAmmoVisibility);
  });
};*/
</script>
    
</body>
</html>
