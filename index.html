<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ê–∫–í—ñ–∑_–ö–ê–ì–ê–†–õ–ò–ö</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; background: #f2f2f2; }
    h1 { font-size: 1.5rem; margin-bottom: 0; }
    .version { font-size: 0.9rem; color: #555; margin-bottom: 1rem; }
    .group { margin-bottom: 1rem; }
    label { display: block; margin-bottom: 0.3rem; }
    input[type=text], input[type=number] {
      width: 100%; padding: 0.5rem; font-size: 1rem;
    }
    input[readonly] { background-color: #eaeaea; }
    button, .button-inline {
      padding: 0.4rem 1rem;
      font-size: 1rem;
      margin-right: 0.5rem;
      margin-top: 0.5rem;
    }
    .lock-button { background: none; border: none; cursor: pointer; font-size: 1.2rem; }
    .inline-buttons { display: flex; gap: 0.5rem; align-items: center; }
    .radio-group { display: flex; flex-direction: column; gap: 0.3rem; }
  </style>
</head>
<body>
  <h1>–ê–∫–í—ñ–∑_–ö–ê–ì–ê–†–õ–ò–ö</h1>
  <div class="version">–í–µ—Ä—Å—ñ—è 1.1.3</div>

  <div class="group">
    <label>–ü—ñ–¥–ø–æ—Ä—è–¥–∫—É–≤–∞–Ω–Ω—è (*)</label>
    <div class="inline-buttons">
      <input type="text" id="sector" readonly>
      <button class="lock-button" onclick="toggleLock('sector')">üîí</button>
    </div>
  </div>

  <div class="group">
    <label>–ü–æ–∑–∏—Ü—ñ—è (*)</label>
    <div class="inline-buttons">
      <input type="text" id="position" readonly>
      <button class="lock-button" onclick="toggleLock('position')">üîí</button>
    </div>
  </div>

  <div class="group">
    <label>–ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç (*)</label>
    <div class="inline-buttons">
      <input type="text" id="location" readonly>
      <button class="lock-button" onclick="toggleLock('location')">üîí</button>
    </div>
  </div>

  <div class="group">
    <label>–¢–∏–ø —Ü—ñ–ª—ñ</label>
    <div class="radio-group">
      <label><input type="radio" name="target" value="–ë–ü–õ–ê –ª—ñ—Ç–∞–∫–æ–≤–æ–≥–æ —Ç–∏–ø—É"> 11111–ë–ü–õ–ê –ª—ñ—Ç–∞–∫–æ–≤–æ–≥–æ —Ç–∏–ø—É</label>
      <label><input type="radio" name="target" value="–ü–æ—Å—Ç—Ä—ñ–ª–∏ (–ó–£, –∫—É–ª–µ–º–µ—Ç)"> –ü–æ—Å—Ç—Ä—ñ–ª–∏ (–ó–£, –∫—É–ª–µ–º–µ—Ç)</label>
      <label><input type="radio" name="target" value="–í–∏—Ö–æ–¥–∏ (–ü–ó–†–ö, –ó–†–ö)"> –í–∏—Ö–æ–¥–∏ (–ü–ó–†–ö, –ó–†–ö)</label>
      <label><input type="radio" name="target" value="–í–∏–±—É—Ö –ö–†"> –í–∏–±—É—Ö –ö–†</label>
      <label><input type="radio" name="target" value="–ì–µ–ª—ñ–∫–æ–ø—Ç–µ—Ä"> –ì–µ–ª—ñ–∫–æ–ø—Ç–µ—Ä</label>
      <label><input type="radio" name="target" value="–õ—ñ—Ç–∞–∫ (–º–∞–ª–∏–π)"> –õ—ñ—Ç–∞–∫ (–º–∞–ª–∏–π)</label>
      <label><input type="radio" name="target" value="–õ—ñ—Ç–∞–∫ (–≤–µ–ª–∏–∫–∏–π)"> –õ—ñ—Ç–∞–∫ (–≤–µ–ª–∏–∫–∏–π)</label>
      <label><input type="radio" name="target" value="–ó–æ–Ω–¥"> –ó–æ–Ω–¥</label>
      <label><input type="radio" name="target" value="–ù–µ–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–µ"> –ù–µ–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–µ</label>
      <label><input type="radio" name="target" value="–Ü–Ω—à–µ"> –Ü–Ω—à–µ</label>
      <label><input type="radio" name="target" value="–ê–µ—Ä–æ—Å—Ç–∞—Ç"> –ê–µ—Ä–æ—Å—Ç–∞—Ç</label>
    </div>
  </div>

  <div class="group">
    <label>–°—Ç–æ—Ä–æ–Ω–∞</label>
    <div class="radio-group">
      <label><input type="radio" name="side" value="–í–æ—Ä–æ–∂–∏–π"> –í–æ—Ä–æ–∂–∏–π</label>
      <label><input type="radio" name="side" value="–°–≤—ñ–π"> –°–≤—ñ–π</label>
      <label><input type="radio" name="side" value="–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∏–π"> –ù–µ–π—Ç—Ä–∞–ª—å–Ω–∏–π</label>
    </div>
  </div>

  <div class="group">
    <label><input type="checkbox" id="noNumber" checked onchange="toggleNumberField()"> –ë–µ–∑ –≤–∏–¥–∞—á—ñ</label>
    <input type="number" id="targetNumber" placeholder="–Ω–æ–º–µ—Ä —Ü—ñ–ª—ñ" readonly>
  </div>

  <div class="group">
    <label>–ù–∞–∑–≤–∞</label>
    <input type="text" id="targetName" placeholder="–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Shahed-136">
    <div class="inline-buttons">
      <button class="button-inline" onclick="fillName('Shahed-136')">Shahed-136</button>
      <button class="button-inline" onclick="fillName('–ì–µ—Ä–±–µ—Ä–∞')">–ì–µ—Ä–±–µ—Ä–∞</button>
    </div>
  </div>

  <div class="group">
    <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å, –æ–¥</label>
    <div class="inline-buttons">
      <input type="number" id="targetCount" value="1" readonly>
      <button onclick="changeCount(1)">+1 –æ–¥.</button>
      <button id="minusBtn" onclick="changeCount(-1)" disabled>-1 –æ–¥.</button>
    </div>
  </div>

  <div class="group">
    <label>–ê–∑–∏–º—É—Ç, ¬∞ (*)</label>
    <input type="number" id="azimuth" placeholder="–í–≤–µ–¥—ñ—Ç—å –∞–±–æ –≤–∏–∑–Ω–∞—á—Ç–µ">
    <div class="inline-buttons">
      <button id="azimuthBtn" onclick="toggleSensor('azimuth')">–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∞–∑–∏–º—É—Ç</button>
    </div>
  </div>

  <div class="group">
    <label>–ö—É—Ä—Å, ¬∞ (*)</label>
    <input type="number" id="course" placeholder="–í–≤–µ–¥—ñ—Ç—å –∞–±–æ –≤–∏–∑–Ω–∞—á—Ç–µ">
    <div class="inline-buttons">
      <button id="courseBtn" onclick="toggleSensor('course')">–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ö—É—Ä—Å</button>
    </div>
  </div>

  <script>
    function toggleLock(id) {
      const input = document.getElementById(id);
      input.readOnly = !input.readOnly;
      if (input.readOnly) {
        localStorage.setItem(id, input.value);
      } else {
        input.focus();
      }
    }

    function loadStoredFields() {
      ['sector', 'position', 'location'].forEach(id => {
        const value = localStorage.getItem(id);
        if (value) document.getElementById(id).value = value;
      });
    }

    function toggleNumberField() {
      const checked = document.getElementById('noNumber').checked;
      const field = document.getElementById('targetNumber');
      field.readOnly = checked;
      if (checked) field.value = '';
    }

    function fillName(name) {
      document.getElementById('targetName').value = name;
    }

    function changeCount(delta) {
      const field = document.getElementById('targetCount');
      let value = parseInt(field.value) + delta;
      if (value <= 1) {
        value = 1;
        document.getElementById('minusBtn').disabled = true;
      } else {
        document.getElementById('minusBtn').disabled = false;
      }
      field.value = value;
    }

    let sensors = {
      azimuth: { active: false, heading: 0 },
      course: { active: false, heading: 0 }
    };

    function toggleSensor(type) {
      const btn = document.getElementById(type + "Btn");
      const field = document.getElementById(type);

      if (!sensors[type].active) {
        requestPermission().then(granted => {
          if (granted) {
            window.addEventListener("deviceorientation", sensors[type].handler = event => {
              let heading = event.webkitCompassHeading !== undefined
                ? Math.round(event.webkitCompassHeading)
                : (event.absolute && event.alpha != null)
                  ? Math.round(360 - event.alpha)
                  : null;
              if (heading != null) {
                sensors[type].heading = heading % 360;
                field.value = sensors[type].heading;
              }
            }, true);
            btn.textContent = "–∑–±–µ—Ä–µ–≥—Ç–∏";
            sensors[type].active = true;
          }
        });
      } else {
        window.removeEventListener("deviceorientation", sensors[type].handler, true);
        field.value = sensors[type].heading;
        btn.textContent = type === 'azimuth' ? "–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∞–∑–∏–º—É—Ç" : "–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ö—É—Ä—Å";
        sensors[type].active = false;
      }
    }

    async function requestPermission() {
      if (typeof DeviceOrientationEvent?.requestPermission === "function") {
        try {
          return await DeviceOrientationEvent.requestPermission() === "granted";
        } catch {
          alert("–î–æ—Å—Ç—É–ø –¥–æ –∫–æ–º–ø–∞—Å–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ.");
          return false;
        }
      }
      return true;
    }

    window.onload = () => {
      loadStoredFields();
      toggleNumberField();
    };
  </script>
  <div class="group">
  <label>üß™ –¢–µ—Å—Ç –∫–æ–º–ø–∞—Å–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ):</label>
  <div id="sensorDebug" style="font-family: monospace; background: #fff; padding: 0.5rem; border: 1px solid #ccc;"></div>
</div>

<script>
  window.addEventListener("deviceorientation", (event) => {
    const debugEl = document.getElementById("sensorDebug");
    const alpha = event.alpha !== null ? event.alpha.toFixed(2) : "null";
    const webkit = event.webkitCompassHeading !== undefined ? event.webkitCompassHeading.toFixed(2) : "–Ω/–¥";
    const absolute = event.absolute !== undefined ? event.absolute : "–Ω/–¥";

    debugEl.innerHTML = `
      alpha (–æ–±–µ—Ä—Ç–∞–Ω–Ω—è): <b>${alpha}</b><br>
      webkitCompassHeading: <b>${webkit}</b><br>
      absolute: <b>${absolute}</b><br>
    `;
  }, true);
</script>

</body>
</html>
